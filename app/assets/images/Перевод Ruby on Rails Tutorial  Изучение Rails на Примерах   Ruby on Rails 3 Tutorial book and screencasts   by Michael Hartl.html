<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0048)http://railstutorial.ru/chapters/4_0/sign-up#top -->
<html lang="ru" xml:lang="ru" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">  <title>Перевод Ruby on Rails Tutorial: Изучение Rails на Примерах | Ruby on Rails 3 Tutorial book and screencasts | by Michael Hartl</title>
<meta name="verification" content="a34fd0835be065ac4e649a0e5452b932">

<meta name="robots" content="all">
<meta name="MSSmartTagsPreventParsing" content="true">
<meta name="description" content="Перевод Ruby on Rails Tutorial: Изучение Rails на Примерах by Michael Hartl">
<meta name="keywords" content="Изучение Ruby Rails Учебник сайт разработка Rails 3">
<meta name="author" content="Michael Hartl">
<meta property="og:title" content="Ruby on Rails Tutorial: Learn Rails by Example">
<meta property="og:site_name" content="Ruby on Rails Tutorial">
<meta property="og:image" content="http://railstutorial.org/images/layout/logo.png">

<meta property="og:url" content="http://railstutorial.org/">
<meta property="og:type" content="article">
<meta property="og:description" content="Ruby on Rails Tutorial: Learn Rails by Example by Michael Hartl teaches web development with Ruby on Rails. Rails Tutorial is fully up-to-date with Rails 3.0.">
<meta name="yandex-verification" content="59b3e8d1c368245d">
<meta name="verify-reformal" content="4b7dc121caf2baf0963a0473">
<meta name="google-site-verification" content="JMHh1fZ6uwuY-koyWFZpi3oA5NP3pqs39uaZCZJ3Mr4">

<link href="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/polytexnic.css" media="screen" rel="stylesheet" type="text/css">
<link href="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/pygments.css" media="screen" rel="stylesheet" type="text/css">
<link href="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
<link href="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/custom.css" media="screen" rel="stylesheet" type="text/css">
<script src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/jquery-1.6.2.min.js" type="text/javascript"></script><style type="text/css"></style>
<script src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/show_origin.js" type="text/javascript"></script>

<!--[if lte IE 7]><link href="/stylesheets/ie.css?1304201481" media="screen" rel="stylesheet" type="text/css" /><![endif]-->
<!--[if lt IE 7]>  <div style='border: 1px solid #F7941D; background: #FEEFDA; text-align: center; clear: both; height: 75px; position: relative;'>    <div style='position: absolute; right: 3px; top: 3px; font-family: courier new; font-weight: bold;'><a href='#' onclick='javascript:this.parentNode.parentNode.style.display="none"; return false;'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-cornerx.jpg' style='border: none;' alt='Close this notice'/></a></div>    <div style='width: 640px; margin: 0 auto; text-align: left; padding: 0; overflow: hidden; color: black;'>      <div style='width: 75px; float: left;'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-warning.jpg' alt='Warning!'/></div>      <div style='width: 275px; float: left; font-family: Arial, sans-serif;'>        <div style='font-size: 14px; font-weight: bold; margin-top: 12px;'>Вы используете устаревший браузер</div>        <div style='font-size: 12px; margin-top: 6px; line-height: 12px;'>Для того, чтобы получить от этого сайта максимум того, на что он способен, пожалуйста, обновите свой браузер.</div>      </div>      <div style='width: 75px; float: left;'><a href='http://www.firefox.com' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-firefox.jpg' style='border: none;' alt='Get Firefox 3.5'/></a></div>      <div style='width: 75px; float: left;'><a href='http://www.browserforthebetter.com/download.html' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-ie8.jpg' style='border: none;' alt='Get Internet Explorer 8'/></a></div>      <div style='width: 73px; float: left;'><a href='http://www.apple.com/safari/download/' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-safari.jpg' style='border: none;' alt='Get Safari 4'/></a></div>      <div style='float: left;'><a href='http://www.google.com/chrome' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-chrome.jpg' style='border: none;' alt='Get Google Chrome'/></a></div>    </div>  </div>  <![endif]-->
<link href="http://feeds.feedburner.com/railstutorial" rel="alternate" title="Rails Tutorial News" type="application/rss+xml">

<script type="text/javascript" async="" src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/reformal.js"></script><style type="text/css" media="screen">#reformal_tab {display:block; font-size:0; background-color:#6b0508 !important; line-height: 0; cursor: pointer; z-index:100001;left:0;margin-top:-112.5px;position:fixed;top:50%;border:1px solid #FFFFFF;padding:10px 4px 10px 4px; border-left:0;   background: #6b0508 url(http://media.reformal.ru/widgets/v3/gl.png) 0 0 repeat-y;    -webkit-border-radius:0 5px 5px 0; -moz-border-radius:0 5px 5px 0; border-radius:0 5px 5px 0; -moz-box-shadow:1px 0 2px #888;  -webkit-box-shadow:1px 0 2px #888;  box-shadow:1px 0 2px #888;}#reformal_tab:hover {padding-left:6px;}#reformal_tab img {border: none; padding:0; margin: 0;}</style></head><body class="book"><a id="reformal_tab" href="http://ror.reformal.ru/" onclick="Reformal.widgetOpen();return false;" onmouseover="Reformal.widgetPreload();" onmouseout="Reformal.widgetAbortPreload();"><img src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/tab.png" alt=""></a><div id="container"><div class="clearfix" id="header"><div id="title"><div id="logo"><a href="http://ruby.railstutorial.org/"><img alt="Logo" src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/logo.png"></a></div><h1 id="name"><a href="http://ruby.railstutorial.org/">Ruby on Rails Tutorial</a></h1><br><h2 id="authors"><a href="http://ruby.railstutorial.org/#author">by Michael Hartl</a></h2></div></div><div id="menu"><div class="links"><div class="box"><span><a href="http://ruby.railstutorial.org/">Оригинал</a></span><span class="division">|</span><span><a href="http://railstutorial.ru/chapters/4_0/beginning">Содержание</a></span><span class="division">|</span><span><a href="http://railstutorial.ru/4_0/help">Помощь</a></span></div></div></div><div id="content"><div id="sidebar"><div class="content"><div id="navtool"><table class="layout"><tbody><tr><td colspan="2"><a href="http://railstutorial.ru/chapters/4_0/sign-up#book_menu"><img alt="Sb_button_up" src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/sb_button_up.png"></a></td></tr><tr><td><a href="http://railstutorial.ru/chapters/4_0/modeling-users#top"><img alt="Previous Chapter" src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/sb_button_prev.png"></a></td><td><a href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#top"><img alt="Next Chapter" src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/sb_button_next.png"></a></td></tr></tbody></table><br><a href="http://ruby.railstutorial.org/#buy"><img alt="Sb_button_buy_screencasts_red" src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/sb_button_buy_screencasts_red.png"></a><div class="section"><div class="switcher custom"><span class="switcher_link title round"><a href="http://railstutorial.ru/chapters/4_0/beginning">Rails 4.0</a></span>&nbsp;•&nbsp; <span class="switcher_link "><a href="http://railstutorial.ru/chapters/3_2/beginning">Rails 3.2</a></span></div></div><a href="http://orphus.ru/" id="orphus" rel="nofollow" target="_blank" title="Система Orphus"><img alt="Система Orphus" border="0" height="31" src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/orphus.gif" width="88"></a></div></div></div><div class="withsidebar" id="main"><div id="book_menu"><a href="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl.html">пропустить содержание</a></div><div id="book_wrap">
  <div id="book_top">
  </div>
    <div id="book">
      <h1 class="title">Ruby on Rails Tutorial </h1>


<h1 class="subtitle"> Изучение Rails на Примерах</h1>


<h2 class="author">Майкл Хартл</h2>


<h1 class="contents">Содержание</h1>


<div id="table_of_contents"><ol>
<li class="chapter"><a href="http://railstutorial.ru/chapters/4_0/preface#top"> Предисловие к русскому изданию</a></li>
<li class="chapter"><a href="http://railstutorial.ru/chapters/4_0/beginning#top"><span class="number">Глава 1</span> От нуля к развертыванию</a></li>
<li><ol><li class="section"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-introduction"><span class="number">1.1</span> Введение</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-comments_for_various_readers"><span class="number">1.1.1</span> Комментарии для разных читателей</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-1_1_2"><span class="number">1.1.2</span> “Масштабирование” Rails</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-conventions"><span class="number">1.1.3</span> Соглашения в этой книге</a></li>
</ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-up_and_running"><span class="number">1.2</span> За работу</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-development_tools"><span class="number">1.2.1</span> Среда разработки</a></li>
<li><ol><li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-1_2_1_1">Интегрированные Среды Разработки</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-1_2_1_2">Текстовые редакторы и инструменты командной строки</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-1_2_1_3">Браузеры</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-1_2_1_4">Примечание об инструментах</a></li>
</ol></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-rubygems"><span class="number">1.2.2</span> Ruby, RubyGems, Rails и Git</a></li>
<li><ol><li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-rails_installer_windows">Rails Installer (Windows)</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-install_git">Установка Git</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-install_ruby">Установка Ruby</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-install_rubygems">Установка RubyGems</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-install_rails">Установка Rails</a></li>
</ol></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-the_first_application"><span class="number">1.2.3</span> Первое приложение</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-bundler"><span class="number">1.2.4</span> Bundler</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-rails_server"><span class="number">1.2.5</span> <tt>rails server</tt></a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-mvc"><span class="number">1.2.6</span> Модель-представление-контроллер (MVC)</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-version_control"><span class="number">1.3</span> Управление версиями с Git</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-git_setup"><span class="number">1.3.1</span> Установка и настройка</a></li>
<li><ol><li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-1_3_1_1">Первоначальная настройка системы</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-1_3_1_2">Первоначальная настройка репозитория</a></li></ol></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-adding_and_committing"><span class="number">1.3.2</span> Добавление и фиксация</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-1_3_3"><span class="number">1.3.3</span> Что хорошего Git делает для вас?</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-github"><span class="number">1.3.4</span> GitHub</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-git_commands"><span class="number">1.3.5</span> Ветвление, редактирование, фиксация, объединение</a></li>
<li><ol><li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-git_branch">Ветвление</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-git_edit">Редактирование</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-git_commit">Фиксация</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-git_merge">Объединение</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-git_push">Отправка</a></li></ol></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-deploying"><span class="number">1.4</span> Развертывание</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-heroku_setup"><span class="number">1.4.1</span> Установка Heroku</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-heroku_step_one"><span class="number">1.4.2</span> Развертывание на Heroku, шаг первый</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-1_4_3"><span class="number">1.4.3</span> Развертывание на Heroku, шаг второй</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-heroku_commands"><span class="number">1.4.4</span> Команды Heroku</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/beginning#sec-beginning_conclusion"><span class="number">1.5</span> Заключение</a></li></ol></li>
<li class="chapter"><a href="http://railstutorial.ru/chapters/4_0/a-demo-app#top"><span class="number">Глава 2</span> demo app</a></li>
<li><ol><li class="section"><a href="http://railstutorial.ru/chapters/4_0/a-demo-app#sec-planning_the_application"><span class="number">2.1</span> Планирование приложения</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/a-demo-app#sec-modeling_demo_users"><span class="number">2.1.1</span> Моделирование пользователей</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/a-demo-app#sec-modeling_demo_microposts"><span class="number">2.1.2</span> Моделирование микросообщений</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/a-demo-app#sec-demo_users_resource"><span class="number">2.2</span> Ресурс Users</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/a-demo-app#sec-a_user_tour"><span class="number">2.2.1</span> Обзор пользователя</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/a-demo-app#sec-mvc_in_action"><span class="number">2.2.2</span> MVC в действии</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/a-demo-app#sec-weaknesses_of_this_users_resource"><span class="number">2.2.3</span> Недостатки данного ресурса Users</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/a-demo-app#sec-microposts_resource"><span class="number">2.3</span> Ресурс Microposts</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/a-demo-app#sec-a_micropost_microtour"><span class="number">2.3.1</span> Микрообзор микросообщений</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/a-demo-app#sec-putting_the_micro_in_microposts"><span class="number">2.3.2</span> Помещение <em>micro</em> в микросообщения</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/a-demo-app#sec-demo_user_has_many_microposts"><span class="number">2.3.3</span> Пользователь <code>has_many</code> микросообщений</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/a-demo-app#sec-inheritance_hierarchies"><span class="number">2.3.4</span> Иерархия наследования</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/a-demo-app#sec-deploying_the_demo_app"><span class="number">2.3.5</span> Развертывание демонстрационного приложения</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/a-demo-app#sec-2_4"><span class="number">2.4</span> Заключение</a></li></ol></li>
<li class="chapter"><a href="http://railstutorial.ru/chapters/4_0/static-pages#top"><span class="number">Глава 3</span> В основном статические страницы</a></li>
<li><ol><li class="section"><a href="http://railstutorial.ru/chapters/4_0/static-pages#sec-static_pages"><span class="number">3.1</span> Статические страницы</a></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/static-pages#sec-first_tests"><span class="number">3.2</span> Наши первые тесты</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/static-pages#sec-TDD"><span class="number">3.2.1</span> Разработка через тестирование</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/static-pages#sec-adding_a_page"><span class="number">3.2.2</span> Добавление страницы</a></li>
<li><ol><li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/static-pages#sec-red" style="color: red;">Красный</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/static-pages#sec-green" style="color: green;">Зеленый</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/static-pages#sec-refactor">Refactor (реорганизация)</a></li></ol></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/static-pages#sec-slightly_dynamic_pages"><span class="number">3.3</span> Немного динамические страницы</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/static-pages#sec-testing_a_title_change"><span class="number">3.3.1</span> Тестирование изменения заголовка</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/static-pages#sec-passing_title_tests"><span class="number">3.3.2</span> Прохождение тестов заголовка</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/static-pages#sec-embedded_ruby"><span class="number">3.3.3</span> Встроенный Ruby</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/static-pages#sec-layouts"><span class="number">3.3.4</span> Устранение дублирования шаблонами</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/static-pages#sec-static_pages_conclusion"><span class="number">3.4</span> Заключение</a></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/static-pages#sec-static_pages_exercises"><span class="number">3.5</span> Упражнения</a></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/static-pages#sec-advanced_setup"><span class="number">3.6</span> Продвинутые настройки</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/static-pages#sec-eliminating_bundle_exec"><span class="number">3.6.1</span> Избавляемся от <tt>bundle exec</tt></a></li>
<li><ol><li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/static-pages#sec-rvm_bundler_integration">RVM Bundler интеграция</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/static-pages#sec-binstubs">binstubs</a></li></ol></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/static-pages#sec-guard"><span class="number">3.6.2</span> Автоматизируем тесты с Guard</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/static-pages#sec-spork"><span class="number">3.6.3</span> Ускоряем тесты с помощью Spork</a></li>
<li><ol><li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/static-pages#sec-spork_and_guard">Guard и Spork</a></li></ol></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/static-pages#sec-tests_inside_sublime_text"><span class="number">3.6.4</span> Запускаем тесты внутри Sublime Text</a></li></ol></li></ol></li>
<li class="chapter"><a href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#top"><span class="number">Глава 4</span> Rails-приправленный Ruby</a></li>
<li><ol><li class="section"><a href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-motivation"><span class="number">4.1</span> Причины</a></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-strings_and_methods"><span class="number">4.2</span> Строки и методы</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-comments"><span class="number">4.2.1</span> Комментарии</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-strings"><span class="number">4.2.2</span> Строки</a></li>
<li><ol><li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-printing">Вывод на экран</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-single_quoted_strings">Строки в одинарных кавычках</a></li></ol></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-objects_and_message_passing"><span class="number">4.2.3</span> Объекты и передача сообщений</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-method_definitions"><span class="number">4.2.4</span> Определение методов</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-back_to_the_title_helper"><span class="number">4.2.5</span> Возвращение к <code>title</code> хелперу</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-other_data_structures"><span class="number">4.3</span> Другие структуры данных</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-arrays_and_ranges"><span class="number">4.3.1</span> Массивы и диапазоны</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-blocks"><span class="number">4.3.2</span> Блоки</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-hashes_and_symbols"><span class="number">4.3.3</span> Хэши и символы</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-css_revisited"><span class="number">4.3.4</span> Вновь CSS</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-ruby_classes"><span class="number">4.4</span> Ruby классы</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-constructors"><span class="number">4.4.1</span> Конструкторы</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-a_class_of_our_own"><span class="number">4.4.2</span> Наследование классов</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-modifying_built_in_classes"><span class="number">4.4.3</span> Изменение встроенных классов</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-a_controller_class"><span class="number">4.4.4</span> Класс контроллер</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-a_user_class"><span class="number">4.4.5</span> Класс User</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-conclusion"><span class="number">4.5</span> Заключение</a></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-exercises"><span class="number">4.6</span> Упражнения</a></li></ol></li>
<li class="chapter"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#top"><span class="number">Глава 5</span> Заполнение шаблона</a></li>
<li><ol><li class="section"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-structure"><span class="number">5.1</span> Добавление некоторых структур</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-adding_to_the_layout"><span class="number">5.1.1</span> Навигация по сайту</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-custom_css"><span class="number">5.1.2</span> Bootstrap и кастомные CSS</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-partials"><span class="number">5.1.3</span> Частичные шаблоны (partials)</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-sass_and_the_asset_pipeline"><span class="number">5.2</span> Sass и файлопровод (asset pipeline)</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-the_asset_pipeline"><span class="number">5.2.1</span> Файлопровод</a></li>
<li><ol><li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-5_2_1_1">Директории ассетов</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-5_2_1_2">Файлы-манифесты</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-5_2_1_3">Препроцессоры</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-5_2_1_4">Производительность в продакшен</a></li></ol></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-sass"><span class="number">5.2.2</span> Синтаксически обалденные таблицы стилей</a></li>
<li><ol><li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-5_2_2_1">Вложение</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-5_2_2_2">Переменные</a></li></ol></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-layout_links"><span class="number">5.3</span> Ссылки в шаблоне</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-route_tests"><span class="number">5.3.1</span> Тестирование маршрутов</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-rails_routes"><span class="number">5.3.2</span> Rails маршруты</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-named_routes"><span class="number">5.3.3</span> Именованные маршруты</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-pretty_rspec"><span class="number">5.3.4</span> Приятный RSpec</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-user_signup"><span class="number">5.4</span> Регистрация пользователей: Первый шаг</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-users_controller"><span class="number">5.4.1</span> Контроллер Users</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-signup_url"><span class="number">5.4.2</span> URL для регистрации</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-layout_conclusion"><span class="number">5.5</span> Заключение</a></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-layout_exercises"><span class="number">5.6</span> Упражнения</a></li></ol></li>
<li class="chapter"><a href="http://railstutorial.ru/chapters/4_0/modeling-users#top"><span class="number">Глава 6</span> Моделирование пользователей</a></li>
<li><ol><li class="section"><a href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-user_model"><span class="number">6.1</span> Модель User</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-database_migrations"><span class="number">6.1.1</span> Миграции базы данных</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-the_model_file"><span class="number">6.1.2</span> Файл модели</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-creating_user_objects"><span class="number">6.1.3</span> Создание объектов user</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-finding_user_objects"><span class="number">6.1.4</span> Поиск объектов user</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-updating_user_objects"><span class="number">6.1.5</span> Обновление объектов user</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-user_validations"><span class="number">6.2</span> Валидации User</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-initial_user_tests"><span class="number">6.2.1</span> Начальные тесты для пользователей</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-presence_validation"><span class="number">6.2.2</span> Валидация наличия</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-length_validation"><span class="number">6.2.3</span> Валидация длины</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-format_validation"><span class="number">6.2.4</span> Валидация формата</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-uniqueness_validation"><span class="number">6.2.5</span> Валидация уникальности</a></li>
<li><ol><li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-the_caveat">Предостережение уникальности</a></li></ol></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-adding_a_secure_password"><span class="number">6.3</span> Добавление безопасного пароля</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-an_encrypted_password"><span class="number">6.3.1</span> Зашифрованный пароль</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-password_and_confirmation"><span class="number">6.3.2</span> Пароль и подтверждение</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-user_authentication"><span class="number">6.3.3</span> Аутентификация пользователя</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-has_secure_password"><span class="number">6.3.4</span> У пользователя есть безопасный пароль</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-creating_a_user"><span class="number">6.3.5</span> Создание пользователя</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-6_4"><span class="number">6.4</span> Заключение</a></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-6_5"><span class="number">6.5</span> Упражнения</a></li></ol></li>
<li class="chapter"><a href="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl.html"><span class="number">Chapter 7</span> Регистрация</a></li>
<li><ol><li class="section"><a href="http://railstutorial.ru/chapters/4_0/sign-up#sec-showing_users"><span class="number">7.1</span> Демонстрация пользователей</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-up#sec-rails_environments"><span class="number">7.1.1</span> Отладка и окружения Rails</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-up#sec-a_users_resource"><span class="number">7.1.2</span> A Ресурс Users</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-up#sec-tests_with_factories"><span class="number">7.1.3</span> Тестирование страницы показывающей пользователя (с фабриками)</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-up#sec-a_gravatar_image"><span class="number">7.1.4</span> Изображение Gravatar и боковая панель</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/sign-up#sec-signup_form"><span class="number">7.2</span> Форма регистрации</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-up#sec-tests_for_user_signup"><span class="number">7.2.1</span> Тесты для регистрации пользователя</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-up#sec-using_form_for"><span class="number">7.2.2</span> Применение <tt>form_for</tt></a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-up#sec-the_form_html"><span class="number">7.2.3</span> HTML формы</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/sign-up#sec-signup_failure"><span class="number">7.3</span> Провальная регистрация</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-up#sec-a_working_form"><span class="number">7.3.1</span> Рабочая форма</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-up#sec-strong_parameters"><span class="number">7.3.2</span> Строгие параметры</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-up#sec-signup_error_messages"><span class="number">7.3.3</span> Сообщения об ошибках при регистрации</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/sign-up#sec-signup_success"><span class="number">7.4</span> Успешная регистрация</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-up#sec-the_finished_signup_form"><span class="number">7.4.1</span> Завершенная форма регистрации</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-up#sec-the_flash"><span class="number">7.4.2</span> Флэш</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-up#sec-the_first_signup"><span class="number">7.4.3</span> Первая регистрация</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-up#sec-deploying_to_production_with_ssl"><span class="number">7.4.4</span> Развертывание приложения на сервере с SSL</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/sign-up#sec-7_5"><span class="number">7.5</span> Заключение</a></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/sign-up#sec-signup_exercises"><span class="number">7.6</span> Упражнения</a></li></ol></li>
<li class="chapter"><a href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#top"><span class="number">Глава 8</span> Войти, выйти</a></li>
<li><ol><li class="section"><a href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#sec-signin_failure"><span class="number">8.1</span> Сессии и провальный вход</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#sec-sessions_controller"><span class="number">8.1.1</span> Sessions контроллер</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#sec-signin_tests"><span class="number">8.1.2</span> Тестирование входа</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#sec-signin_form"><span class="number">8.1.3</span> Форма для входа</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#sec-reviewing_form_submission"><span class="number">8.1.4</span> Обзор отправки формы</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#sec-rendering_with_a_flash_message"><span class="number">8.1.5</span> Рендеринг
с флэш сообщением</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#sec-signin_success"><span class="number">8.2</span> Успешный вход</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#sec-remember_me"><span class="number">8.2.1</span> Запомнить меня</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#sec-a_working_sign_in_method"><span class="number">8.2.2</span> Рабочий метод <tt>sign_in</tt></a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#sec-current_user"><span class="number">8.2.3</span> Текущий пользователь</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#sec-changing_the_layout_links"><span class="number">8.2.4</span> Изменение ссылок шаблона</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#sec-signin_upon_signup"><span class="number">8.2.5</span> Вход после регистрации</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#sec-signing_out"><span class="number">8.2.6</span> Выход</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#sec-cucumber"><span class="number">8.3</span> Введение в Cucumber (опционально)</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#sec-installation_and_setup"><span class="number">8.3.1</span> Установка и настройка</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#sec-features_and_steps"><span class="number">8.3.2</span> Фичи и шаги</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#sec-rspec_custom_matchers"><span class="number">8.3.3</span> Контрапункт: кастомные проверки RSpec</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#sec-8_4"><span class="number">8.4</span> Заключение</a></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#sec-sign_in_out_exercises"><span class="number">8.5</span> Упражнения</a></li></ol></li>

<li class="chapter"><a href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#top"><span class="number">Глава 9</span> Обновление, демонстрация и удаление пользователей</a></li>
<li><ol><li class="section"><a href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#sec-updating_users"><span class="number">9.1</span> Обновление пользователей</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#sec-edit_form"><span class="number">9.1.1</span> Форма для редактирования</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#sec-unsuccessful_edits"><span class="number">9.1.2</span> Провальное редактирование</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#sec-successful_edits"><span class="number">9.1.3</span> Успешное редактирование</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#sec-authorization"><span class="number">9.2</span> Авторизация</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#sec-requiring_signed_in_users"><span class="number">9.2.1</span> Требование входа пользователей</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#sec-requiring_the_right_user"><span class="number">9.2.2</span> Требование правильного пользователя</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#sec-friendly_forwarding"><span class="number">9.2.3</span> Дружелюбная переадресация</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#sec-showing_all_users"><span class="number">9.3</span> Отображение всех пользователей</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#sec-user_index"><span class="number">9.3.1</span> Список пользователей</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#sec-sample_users"><span class="number">9.3.2</span> Образцы пользователей</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#sec-pagination"><span class="number">9.3.3</span> Пагинация</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#sec-partial_refactoring"><span class="number">9.3.4</span> Частичный рефакторинг</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#sec-destroying_users"><span class="number">9.4</span> Уничтожение пользователей</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#sec-administrative_users"><span class="number">9.4.1</span> Административные пользователи</a></li>
<li><ol><li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#sec-revisiting_strong_parameters">Возвращение к строгим параметрам</a></li></ol></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#sec-the_destroy_action"><span class="number">9.4.2</span> <tt>Destroy</tt> действие</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#sec-updating_and_deleting_users_conclusion"><span class="number">9.5</span> Заключение</a></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#sec-updating_deleting_exercises"><span class="number">9.6</span> Упражнения</a></li></ol></li>

<li class="chapter"><a href="http://railstutorial.ru/chapters/4_0/user-microposts#top"><span class="number">Глава 10</span> Микросообщения пользователей</a></li>
<li><ol><li class="section"><a href="http://railstutorial.ru/chapters/4_0/user-microposts#sec-a_micropost_model"><span class="number">10.1</span> Модель Micropost</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/user-microposts#sec-the_basic_model"><span class="number">10.1.1</span> Базовая модель</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/user-microposts#sec-first_micropost_validation"><span class="number">10.1.2</span> Первая валидация</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/user-microposts#sec-user_micropost_associations"><span class="number">10.1.3</span> Ассоциации Пользователь/Микросообщения</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/user-microposts#sec-ordering_and_dependency"><span class="number">10.1.4</span> Улучшение микросообщений</a></li>
<li><ol><li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/user-microposts#sec-default_scope">Дефолтное пространство (scope)</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/user-microposts#sec-dependent_destroy">Dependent: destroy</a></li></ol></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/user-microposts#sec-micropost_validations"><span class="number">10.1.5</span> Валидации контента</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/user-microposts#sec-showing_microposts"><span class="number">10.2</span> Просмотр микросообщений</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/user-microposts#sec-augmenting_the_user_show_page"><span class="number">10.2.1</span> Дополнение страницы показывающей пользователя</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/user-microposts#sec-sample_microposts"><span class="number">10.2.2</span> Образцы микросообщений</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/user-microposts#sec-manipulating_microposts"><span class="number">10.3</span> Манипулирование микросообщениями</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/user-microposts#sec-access_control"><span class="number">10.3.1</span> Контроль доступа</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/user-microposts#sec-creating_microposts"><span class="number">10.3.2</span> Создание микросообщений</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/user-microposts#sec-a_proto_feed"><span class="number">10.3.3</span> Предварительная реализация потока сообщений</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/user-microposts#sec-destroying_microposts"><span class="number">10.3.4</span> Уничтожение микросообщений</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/user-microposts#sec-10_4"><span class="number">10.4</span> Заключение</a></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/user-microposts#sec-micropost_exercises"><span class="number">10.5</span> Упражнения</a></li></ol></li>
<li class="chapter"><a href="http://railstutorial.ru/chapters/4_0/following-users#top"><span class="number">Глава 11</span> Слежение за сообщениями пользователей</a></li>
<li><ol><li class="section"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-the_relationship_model"><span class="number">11.1</span> Модель Relationship</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-a_problem_with_the_data_model"><span class="number">11.1.1</span> Проблема с моделью данных (и ее решение)</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-relationship_user_associations"><span class="number">11.1.2</span> Ассоциации пользователь/взаимоотношение</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-relationship_validations"><span class="number">11.1.3</span> Валидации</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-following"><span class="number">11.1.4</span> Читаемые пользователи</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-followers"><span class="number">11.1.5</span> Читатели пользователя</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-a_web_interface_for_following_and_followers"><span class="number">11.2</span> Веб-интерфейс для читаемых пользователей</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-sample_following_data"><span class="number">11.2.1</span> Образцы данных</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-stats_and_a_follow_form"><span class="number">11.2.2</span> Статистика и форма для слежения за сообщениями пользователя</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-following_and_followers_pages"><span class="number">11.2.3</span> Страницы с читаемыми и читателями</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-a_working_follow_button_the_standard_way"><span class="number">11.2.4</span> Стандартный способ реализации кнопки "читать" (follow)</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-a_working_follow_button_with_ajax"><span class="number">11.2.5</span> Реализация кнопки "читать" (follow) с Ajax</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-the_status_feed"><span class="number">11.3</span> Поток сообщений</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-motivation_and_strategy"><span class="number">11.3.1</span> Мотивация и стратегия</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-a_first_feed_implementation"><span class="number">11.3.2</span> Первая реализация потока сообщений</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-scopes_subselects_and_a_lambda"><span class="number">11.3.3</span> Подзапросы</a></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-the_new_status_feed"><span class="number">11.3.4</span> Новый поток сообщений</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-following_conclusion"><span class="number">11.4</span> Заключение</a></li>
<li><ol><li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-extensions_to_the_sample_application"><span class="number">11.4.1</span> Расширения к примеру приложения</a></li>
<li><ol><li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-replies">Реплики</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-messaging">Обмен сообщениями</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-follower_notifications">Уведомления о новых читателях</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-password_reminders">Напоминание пароля</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-signup_confirmation">Подтверждение регистрации</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-rss_feed">RSS канал</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-rest_api">REST API</a></li>
<li class="subsubsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-search">Поиск</a></li></ol></li>
<li class="subsection"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-guide_to_further_resources"><span class="number">11.4.2</span> Руководство по дальнейшим ресурсам</a></li></ol></li>
<li class="section"><a href="http://railstutorial.ru/chapters/4_0/following-users#sec-following_exercises"><span class="number">11.5</span> Упражнения</a></li></ol></li></ol></div>

      <div id="main_content"></div>


<p> <span class="preamble">
 <span id="foreword">
<strong> Предисловие</strong> <br>
 </span>
 </span></p>

<p>Моя компания (CD Baby) была одной из первых громко перешедших на Ruby on Rails, а затем еще громче вернувшейся обратно на PHP (Google расскажет вам об этой драме). Эту книгу, написанную Майклом Хартлом так высоко рекомендовали, что я должен был попробовать её, и <em>Ruby on Rails Tutorial</em> это всё, что я использовал, чтобы вернуться к Rails.</p>

<p>Хотя я уже прошел через много книг по Rails, это одна из немногих, что, наконец, зацепила меня. Было много написано книг типа «Путь Rails» — после которых я чувствовал себя неестественно, но после этой книги я наконец почувствовал себя естественно. Это также единственная книга по Rails, которая соблюдает методику «разработка через тестирование» на всем своем протяжении, этот подход строго рекомендуется специалистами, но он никогда не был так чётко продемонстрирован ранее. Наконец, Git, GitHub и Heroku присутствуют в демо-примерах, автор действительно дает вам почувствовать, что он хотел сделать реальный проект. Учебный код примеров не изолирован.</p>

<p>Линейное повествование — отличный формат. Лично я прошел Rails Tutorial в течении трёх долгих дней, делая все примеры и задачи в конце каждой главы. Делайте всё от начала до конца, не прыгая, и вы получите максимальную пользу.</p>

<p>Наслаждайтесь!</p>

<p><a href="http://sivers.org/">Derek Sivers</a> (<a href="http://sivers.org/">sivers.org</a>) <br>
<em>Основатель </em> <a href="http://www.cdbaby.com/"><em>CD Baby</em></a> <br></p>

<p> <span class="preamble">
<strong> Благодарности</strong> <br>
 </span></p>

<p><em>Ruby On Rails Учебник</em> во многом обязан моей предыдущей книге по Rails, <em>RailsSpace</em> и, следовательно, моему соавтору <a href="http://aure.com/">Aurelius Prochazka</a>. Я хотел бы поблагодарить Aure как за работу, которую он проделал над прошлой книгой, так и за поддержку этой. Я также хотел бы поблагодарить Debra Williams Cauley, редактора обеих книг <em>RailsSpace</em> и <em>Rails Tutorial</em>; до тех пор, пока она не прекратит брать меня на бейсбол, я буду продолжать писать книги для нее.</p>

<p>Я хотел бы поблагодарить огромное количество Рубистов учивших и вдохновлявших меня на протяжении многих лет: David Heinemeier Hansson, Yehuda Katz, Carl Lerche, Jeremy Kemper, Xavier Noria, Ryan Bates, Geoffrey Grosenbach, Peter Cooper, Matt Aimonetti, Gregg Pollack, Wayne&nbsp;E. Seguin, Amy Hoy, Dave Chelimsky, Pat Maddox, Tom Preston-Werner, Chris Wanstrath, Chad Fowler, Josh Susser, Obie Fernandez, Ian McFarland, Steven Bristol, Pratik Naik, Sarah Mei, Sarah Allen, Wolfram Arnold, Alex Chaffee, Giles Bowkett, Evan Dorn, Long Nguyen, James Lindenbaum, Adam Wiggins, Tikhon Bernstam, Ron Evans, Wyatt Greene, Miles Forrest, хороших людей из Pivotal Labs, команду Heroku, thoughtbot ребят, и команду GitHub. Наконец, многих, многих читателей - слишком много чтобы перечислять их здесь - внёсших большое количество предложений по улучшению и сообщивших об ошибках во время написания этой книги, и я с благодарностью признаю их помощь в написании ее настолько хорошей, насколько это было возможно. <br></p>

<p> <span class="preamble">
 <span id="author">
<strong> Об авторе</strong> <br>
 </span>
 </span></p>

<p><a href="http://michaelhartl.com/">Майкл Хартл</a> – автор <a href="http://ruby.railstutorial.org/"><em>Ruby on Rails Tutorial</em></a>, лидирующего введения в веб разработку на <a href="http://rubyonrails.org/">Ruby on Rails</a>. Его предыдущий опыт включает в себя написание и разработку <em>RailsSpace</em> - чрезвычайно устаревшего учебника по Rails и разработку Insoshi - некогда популярной, а ныне устаревшей платформы для социальных сетей написанной на Ruby on Rails. В 2011, Майкл получил <a href="http://rubyheroes.com/heroes">Ruby Hero Award</a> за его вклад в Ruby сообщество. Он закончил <a href="http://college.harvard.edu/">Harvard College</a>, имеет <a href="http://resolver.caltech.edu/CaltechETD:etd-05222003-161626">степень Кандидата Физических Наук</a> присвоенную в <a href="http://www.caltech.edu/">Caltech</a> и является выпускником предпринимательских курсов <a href="http://ycombinator.com/">Y&nbsp;Combinator</a>. <br></p>

<p> <span id="license" class="preamble">
<strong> Копирайт и лицензия</strong> <br>
 </span></p>

<p><em>Ruby on Rails Tutorial: Learn Web Development with Rails</em>. Copyright © 2012 by Michael Hartl. Весь исходный код в <em>Ruby on Rails Tutorial</em> доступен под <a href="http://opensource.org/licenses/MIT">MIT License</a> и <a href="http://people.freebsd.org/~phk/">Beerware License</a>.</p>

<div class="code"><div class="highlight">

<pre>Лицензия MIT

Copyright (c) 2013 Michael Hartl

Данная лицензия разрешает лицам, получившим копию данного программного
обеспечения и сопутствующей документации (в дальнейшем именуемыми
«Программное Обеспечение»), безвозмездно использовать Программное
Обеспечение без ограничений, включая неограниченное право на использование,
копирование, изменение, добавление, публикацию, распространение,
сублицензирование и/или продажу копий Программного Обеспечения, также
как и лицам, которым предоставляется данное Программное Обеспечение,
при соблюдении следующих условий:

Указанное выше уведомление об авторском праве и данные условия должны быть
включены во все копии или значимые части данного Программного Обеспечения.

ДАННОЕ ПРОГРАММНОЕ ОБЕСПЕЧЕНИЕ ПРЕДОСТАВЛЯЕТСЯ «КАК ЕСТЬ», БЕЗ КАКИХ-ЛИБО
ГАРАНТИЙ, ЯВНО ВЫРАЖЕННЫХ ИЛИ ПОДРАЗУМЕВАЕМЫХ, ВКЛЮЧАЯ, НО НЕ ОГРАНИЧИВАЯСЬ
ГАРАНТИЯМИ ТОВАРНОЙ ПРИГОДНОСТИ, СООТВЕТСТВИЯ ПО ЕГО КОНКРЕТНОМУ НАЗНАЧЕНИЮ И
ОТСУТСТВИЯ НАРУШЕНИЙ ПРАВ. НИ В КАКОМ СЛУЧАЕ АВТОРЫ ИЛИ ПРАВООБЛАДАТЕЛИ НЕ
НЕСУТ ОТВЕТСТВЕННОСТИ ПО ИСКАМ О ВОЗМЕЩЕНИИ УЩЕРБА, УБЫТКОВ ИЛИ ДРУГИХ
ТРЕБОВАНИЙ ПО ДЕЙСТВУЮЩИМ КОНТРАКТАМ, ДЕЛИКТАМ ИЛИ ИНОМУ, ВОЗНИКШИМ ИЗ,
ИМЕЮЩИМ ПРИЧИНОЙ ИЛИ СВЯЗАННЫМ С ПРОГРАММНЫМ ОБЕСПЕЧЕНИЕМ ИЛИ ИСПОЛЬЗОВАНИЕМ
ПРОГРАММНОГО ОБЕСПЕЧЕНИЯ ИЛИ ИНЫМИ ДЕЙСТВИЯМИ С ПРОГРАММНЫМ ОБЕСПЕЧЕНИЕМ.
</pre></div>
</div>


<div class="code"><div class="highlight"><pre>/*
 * ----------------------------------------------------------------------------
 * "ПИВНАЯ ЛИЦЕНЗИЯ" (Ревизия 42):
 * Весь код написан Майклом Хартлом. До тех пор пока вы осознаете это,
 * вы можете делать с ним все что захотите. Если мы когда нибудь
 * встретимся, и если это того стоило, вы можете купить мне
 * пиво в ответ.
 * ----------------------------------------------------------------------------
 */
</pre></div>
</div>

      <div id="top"></div>


<h1 class="chapter"><a id="sec-7" href="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl.html" class="heading"><span class="number">Глава 7</span> Регистрация</a></h1>


<p>Теперь, когда у нас есть рабочая модель User, пришло время добавить возможность, без которой некоторые сайты просто жить не могут: позволить пользователям регистрироваться на сайте. Мы будем использовать HTML <em>форму</em> для предоставления пользователями регистрационной информации нашему приложению в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-signup_form">Разделе&nbsp;7.2</a>, которая затем будет использована для создания нового пользователя и сохранения его атрибутов в базе данных в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-signup_success">Разделе&nbsp;7.4</a>. В конце процесса регистрации важно отобразить страницу профиля с информацией о новом созданном пользователе, так что мы начнем с создания страницы для <em>демонстрации</em> пользователей, которая будет для нас первым шагом на пути реализации  REST архитектуры для пользователей (<a class="ref" href="http://railstutorial.ru/chapters/4_0/a-demo-app#sec-mvc_in_action">Раздел&nbsp;2.2.2</a>). Как обычно, мы будем писать тесты по мере разработки, расширяя наши познания о применении  RSpec и Capybara для написания кратких и выразительных интеграционных тестов.</p>

<p>Для того чтобы создать страницу профиля пользователя, нам необходимо иметь пользователя в базе данных, что представлеяет проблему яйца и курицы: как сайт может иметь пользователя до появления рабочей страницы регистрации? К счастью, эта проблема уже решена: в <a class="ref" href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-creating_a_user">Разделе&nbsp;6.3.5</a> мы создавали запись User вручную с помощью Rails консоли. Если вы пропустили этот раздел, вам следует вернуться и закончить его перед продолжением.</p>

<p>Если вы используете управление версиями, создайте тему ветки, как обычно:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git checkout master
<span class="gp">$</span> git checkout -b sign-up
</pre></div>
</div>


<div class="label" id="sec-showing_users"></div>


<h2><a id="sec-7_1" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-showing_users" class="heading"><span class="number">7.1</span> Демонстрация пользователей</a></h2>


<p>В этом разделе мы сделаем первый шаг на пути к конечной странице пользователя, создав страницу для отображения имени и фотографии пользователя, на что указывает набросок страницы на <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-profile_mockup_profile_name">Рис.&nbsp;7.1</a>.<sup class="footnote" id="fnref-7_1"><a href="http://railstutorial.ru/chapters/4_0/sign-up#fn-7_1">1</a></sup> Нашей конечной целью для страниц профиля пользователя является отображение фотографии пользователя, основных данных пользователя и списка микросообщений, как показано на наброске в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-profile_mockup">Рис.&nbsp;7.2</a>.<sup class="footnote" id="fnref-7_2"><a href="http://railstutorial.ru/chapters/4_0/sign-up#fn-7_2">2</a></sup> (на <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-profile_mockup">Рис.&nbsp;7.2</a> показан наш первый пример <em>lorem ipsum</em> текста, который имеет <a href="http://www.straightdope.com/columns/read/2290/what-does-the-filler-text-lorem-ipsum-mean">захватывающую историю</a> которую вам решительно стоит прочитать на досуге.) Мы закончим эту задачу, а вместе с ней и пример приложения, в  <a class="ref" href="http://railstutorial.ru/chapters/4_0/following-users#top">Главе&nbsp;11</a>.</p>

<div class="label" id="fig-profile_mockup_profile_name"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/profile_mockup_profile_name_bootstrap.png" alt="profile_mockup_profile_name_bootstrap"></span></div><div class="caption"><span class="header">Рис. 7.1: </span><span class="description">Набросок страницы профиля пользователя которая будет сделана в этом разделе.&nbsp;<a href="http://railstutorial.org/images/figures/profile_mockup_profile_name_bootstrap-full.png">(полный размер)</a></span></div></div>




<div class="label" id="fig-profile_mockup"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/profile_mockup_bootstrap.png" alt="profile_mockup_bootstrap"></span></div><div class="caption"><span class="header">Рис. 7.2: </span><span class="description">Набросок наших лучших ожиданий от конечной страницы профиля.&nbsp;<a href="http://railstutorial.org/images/figures/profile_mockup_bootstrap-full.png">(полный размер)</a></span></div></div>


<div class="label" id="sec-rails_environments"></div>


<h3><a id="sec-7_1_1" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-rails_environments" class="heading"><span class="number">7.1.1</span> Отладка и окружения Rails</a></h3>


<p>Профили в этом разделе будут первыми по-настоящему динамическими страницами в нашем приложении. Хотя представление будет существовать как одна страница кода, каждый профиль будет кастомизирован с использованием информации получаемой из базы данных сайта. В качестве подготовки к добавлению динамических страниц в наш пример приложения, сейчас хорошее время, чтобы добавить некоторую отладочную информацию к шаблону нашего сайта (<a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-rails_debug">Листинг&nbsp;7.1</a>). Это отображает некоторую полезную информацию о каждой странице с помощью встроенного <code>debug</code> метода и <code>params</code> переменной (о которой мы узнаем больше в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-a_users_resource">Разделе&nbsp;7.1.2</a>).</p>

<div class="label" id="code-rails_debug"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.1.</span> <span class="description">Добавление отладочной информации к шаблону сайта. <br> <code>app/views/layouts/application.html.erb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  .
  .
  .
  <span class="nt">&lt;body&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'layouts/header'</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'layouts/footer'</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">debug</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="k">if</span> <span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">development?</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>Для того чтобы вывод отладочной информации приятно выглядел, мы добавим несколько правил к кастомной таблице стилей созданной в <a class="ref" href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#top">Главе&nbsp;5</a>, как это показано в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-mixin_and_debug">Листинге&nbsp;7.2</a>.</p>

<div class="label" id="code-mixin_and_debug"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.2.</span> <span class="description">Добавление кода для красивого блока с отладочной информацией, включая примесь Sass. <br> <code>app/assets/stylesheets/custom.css.scss</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">@import</span> <span class="s2">"bootstrap"</span><span class="p">;</span>

<span class="cm">/* mixins, variables, etc. */</span>

<span class="nv">$grayMediumLight</span><span class="o">:</span> <span class="mh">#eaeaea</span><span class="p">;</span>

<span class="k">@mixin</span><span class="nf"> box_sizing</span> <span class="p">{</span>
  <span class="na">-moz-box-sizing</span><span class="o">:</span> <span class="no">border</span><span class="o">-</span><span class="n">box</span><span class="p">;</span>
  <span class="na">-webkit-box-sizing</span><span class="o">:</span> <span class="no">border</span><span class="o">-</span><span class="n">box</span><span class="p">;</span>
  <span class="na">box-sizing</span><span class="o">:</span> <span class="no">border</span><span class="o">-</span><span class="n">box</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>

<span class="o">/*</span> <span class="nt">miscellaneous</span> <span class="o">*/</span>

<span class="nc">.debug_dump</span> <span class="p">{</span>
  <span class="na">clear</span><span class="o">:</span> <span class="no">both</span><span class="p">;</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="na">width</span><span class="o">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
  <span class="na">margin-top</span><span class="o">:</span> <span class="mi">45</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">@include</span><span class="nd"> box_sizing</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div></div>


<p>Этот код вводит новую для нас возможность Sass -  <em>примесь</em>, в данном случае названную <code>box_sizing</code>. Примесь позволяет группировать  CSS правила с тем чтобы они могли использоваться для нескольких элементов, конвертируя</p>

<div class="code"><div class="highlight"><pre><span class="nc">.debug_dump</span> <span class="p">{</span>
  <span class="nc">.</span>
  <span class="nc">.</span>
  <span class="nc">.</span>
  <span class="o">@</span><span class="nt">include</span> <span class="nt">box_sizing</span><span class="o">;</span>
<span class="p">}</span>
</pre></div>
</div>


<p>в</p>

<div class="code"><div class="highlight"><pre><span class="nc">.debug_dump</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">-moz-box-sizing</span><span class="o">:</span> <span class="no">border</span><span class="o">-</span><span class="n">box</span><span class="p">;</span>
  <span class="na">-webkit-box-sizing</span><span class="o">:</span> <span class="no">border</span><span class="o">-</span><span class="n">box</span><span class="p">;</span>
  <span class="na">box-sizing</span><span class="o">:</span> <span class="no">border</span><span class="o">-</span><span class="n">box</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>


<p>Мы еще раз применим эту примесь в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-using_form_for">Разделе&nbsp;7.2.2</a>. Результат ее применения в контексте блока с отладочной информацией показан на  <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-home_page_with_debug">Рис.&nbsp;7.3</a>.</p>

<div class="label" id="fig-home_page_with_debug"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/home_page_with_debug_4_0.png" alt="home_page_with_debug_4_0"></span></div><div class="caption"><span class="header">Рис. 7.3: </span><span class="description">Home страница примера приложения (<a href="http://localhost:3000/">/</a>) с отладочной информацией.&nbsp;<a href="http://railstutorial.org/images/figures/home_page_with_debug_4_0-full.png">(полный размер)</a></span></div></div>


<p>Вывод отладочной информации на <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-home_page_with_debug">Рис.&nbsp;7.3</a> дает потенциально полезную информацию об отображаемой в настоящий момент странице:</p>

<div class="code"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">controller</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">static_pages</span>
<span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">home</span>
</pre></div>
</div>


<p>Это YAML<sup class="footnote" id="fnref-7_3"><a href="http://railstutorial.ru/chapters/4_0/sign-up#fn-7_3">3</a></sup> представление <code>params</code>, который по сути является хэшем и в данном случае указывает на контроллер и действие страницы. Мы увидим еще один пример в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-a_users_resource">Разделе&nbsp;7.1.2</a></p>

<p>Поскольку мы не хотим показывать отладочную информацию пользователям развернутого приложения, <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-rails_debug">Листинг&nbsp;7.1</a> использует</p>

<div class="code"><div class="highlight"><pre><span class="k">if</span> <span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">development?</span>
</pre></div>
</div>


<p>для того чтобы показывать отладочную информацию только  в <em>среде разработки</em>, которая является одной из трех сред, определенных по умолчанию в Rails (<a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#sidebar-rails_environments">Блок&nbsp;7.1</a>).<sup class="footnote" id="fnref-7_4"><a href="http://railstutorial.ru/chapters/4_0/sign-up#fn-7_4">4</a></sup> В частности, <code>Rails.env.development?</code> является <code>true</code> только в среде разработки, так что Embedded Ruby</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">debug</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="k">if</span> <span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">development?</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>не будет вставлен в развернутое приложение или тесты. (Вставка отладочной информации в тесты возможно не навредит, но скорее всего и не сделает ничего хорошего, так что лучше ограничиться ее отображением только в среде разработки.)</p>

<div class="label" id="sidebar-rails_environments"></div>


<div class="sidebar"><span class="title"><span class="header">Блок 7.1.</span><span class="description">Окружения Rails</span></span>
<p>Rails поставляется с тремя окружениями: <tt>test</tt>, <tt>development</tt> и <tt>production</tt>. Дефолтным окружением для Rails консоли является <tt>development</tt>:</p>

<pre class="verbatim">  $ rails console
  Loading development environment
  &gt;&gt; Rails.env
  =&gt; "development"
  &gt;&gt; Rails.env.development?
  =&gt; true
  &gt;&gt; Rails.env.test?
  =&gt; false</pre>


<p>Как вы можете видеть, Rails обеспечивает объект <tt>Rails</tt> атрибутом <tt>env</tt> и связанными с ним булевыми методами окружения, таким образом, например, <tt>Rails.env.test?</tt> возвращает <tt>true</tt> в тестовом окружении и  <tt>false</tt> во всех остальных.</p>

<p>Если вам когда либо понадобится запустить консоль в окружении, отличном от дефолтного (для отладки теста, например), вы можете предать окружение в качестве параметра к <tt>console</tt> скрипту:</p>

<pre class="verbatim">  $ rails console test
  Loading test environment
  &gt;&gt; Rails.env
  =&gt; "test"
  &gt;&gt; Rails.env.test?
  =&gt; true</pre>


<p>Как и в случае с консолью, <tt>development</tt> является дефолтным окружением для локального  Rails сервера, но вы также можете запустить его и в другом окружении:</p>

<pre class="verbatim">  $ rails server --environment production</pre>


<p>Если вы попробуете посмотреть на свое приложение запущенное в production, оно не будет работать без production базы данных, которую мы можем создать запустив <tt>rake db:migrate</tt> в production:</p>

<pre class="verbatim">  $ bundle exec rake db:migrate RAILS_ENV=production</pre>


<p>(Я считаю запутывающим, когда консоль, сервер и команды миграций устанавливают не дефолтные окружения тремя взаимно исключающими способами, поэтому я дал себе труд показать все три.)</p>

<p>Кстати, если вы развернули свое приложение на Heroku, вы можете посмотреть его окружение с помощью команды <tt>heroku</tt>, которая предоставляет свою собственную (удаленную) консоль:</p>

<pre class="verbatim">  $ heroku run console
  Ruby console for yourapp.herokuapp.com
  &gt;&gt; Rails.env
  =&gt; "production"
  &gt;&gt; Rails.env.production?
  =&gt; true</pre>


<p>Вполне естественно, что, поскольку Heroku является платформой для production сайтов, он запускает каждое приложение в  production окружении.</p>
</div>




<div class="label" id="sec-a_users_resource"></div>


<h3><a id="sec-7_1_2" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-a_users_resource" class="heading"><span class="number">7.1.2</span> Ресурс Users</a></h3>


<p>В конце <a class="ref" href="http://railstutorial.ru/chapters/4_0/modeling-users#top">Главы&nbsp;6</a> мы создали нового пользователя в базе данных. Как показано в <a class="ref" href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-creating_a_user">Разделе&nbsp;6.3.5</a>, этот пользователь имеет id&nbsp;<code>1</code> и наша цель теперь заключается в создании страницы для отображения информации этого пользователя. Мы будем следовать соглашениям REST архитектуры, предпочитаемой Rails в Rails приложениях (<a class="ref" href="http://railstutorial.ru/chapters/4_0/a-demo-app#sidebar-REST">Блок&nbsp;2.2</a>), что означает представление данных в качестве <em>ресурсов</em> которые могут быть созданы, показаны, обновлены, или уничтожены — четыре действия, соответствующие четырем фундаментальным операциям <tt>POST</tt>, <tt>GET</tt>, <tt>PATCH</tt> и <tt>DELETE</tt> определенным <a href="http://ru.wikipedia.org/wiki/HTTP">стандартом HTTP</a> (<a class="ref" href="http://railstutorial.ru/chapters/4_0/static-pages#sidebar-get_etc">Блок&nbsp;3.3</a>).</p>

<p>Следуя принципам REST, на ресурсы обычно ссылаются, используя имя ресурса и уникальный идентификатор. Что это означает в контексте пользователей — о которых мы теперь думаем, как о <em>ресурсе</em> Users—то, что мы должны показать пользователя с id&nbsp;<code>1</code> выдав <tt>GET</tt> запрос к URL <tt>/users/1</tt>. Здесь <code>show</code> действие <em>неявно</em> в типе запроса —когда Rails’ функции REST активированы, <tt>GET</tt> запросы автоматически обрабатываются <code>show</code> действием.</p>

<p>Мы видели в <a class="ref" href="http://railstutorial.ru/chapters/4_0/a-demo-app#sec-a_user_tour">Разделе&nbsp;2.2.1</a> что страница для пользователя с id&nbsp;<code>1</code> имеет URL /users/1. К сожалению, сейчас посещение этой страницы лишь выдает ошибку (<a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-profile_routing_error">Рис.&nbsp;7.4</a>).</p>

<div class="label" id="fig-profile_routing_error"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/profile_routing_error.png" alt="profile_routing_error"></span></div><div class="caption"><span class="header">Рис. 7.4: </span><span class="description">Страница ошибки для /users/1.&nbsp;<a href="http://railstutorial.org/images/figures/profile_routing_error-full.png">(полный размер)</a></span></div></div>


<p>Мы можем заполучить REST-style Users URL на работу, добавив одну-единственную строку в наш файл маршрутов (<code>config/routes.rb</code>):</p>

<div class="code"><div class="highlight"><pre><span class="n">resources</span> <span class="ss">:users</span>
</pre></div>
</div>


<p>Результат представлен в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-users_resource">Листинге&nbsp;7.3</a>.</p>

<div class="label" id="code-users_resource"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.3.</span> <span class="description">Добавление ресурса Users в файл маршрутов. <br> <code>config/routes.rb</code></span></div>
<div class="code"><div class="highlight"><pre><span class="ss">SampleApp::Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:users</span>
  <span class="n">root</span>  <span class="s1">'static_pages#home'</span>
  <span class="n">match</span> <span class="s1">'/signup'</span><span class="p">,</span>  <span class="ss">to:</span> <span class="s1">'users#new'</span><span class="p">,</span>            <span class="ss">via:</span> <span class="s1">'get'</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Вы возможно заметили, что <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-users_resource">листинг&nbsp;7.3</a> удаляет строку</p>

<div class="code"><div class="highlight"><pre><span class="n">get</span> <span class="s2">"users/new"</span>
</pre></div>
</div>


<p>последний раз замеченную в <a class="ref" href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#code-signup_route">Листинге&nbsp;5.35</a>. Это связано с тем, что <code>resources :users</code> не просто добавляет работающий /users/1 URL; эта строка также обеспечивает наш пример приложения всеми действиями, необходимыми для RESTful (полностью REST) ресурса Users,<sup class="footnote" id="fnref-7_5"><a href="http://railstutorial.ru/chapters/4_0/sign-up#fn-7_5">5</a></sup> наряду с большим количеством именованных маршрутов (<a class="ref" href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-named_routes">Раздел&nbsp;5.3.3</a>) для генерации URL пользователя. Получившееся  соответствие URL, действий и именованных маршрутов показано в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#table-RESTful_users">Таблице&nbsp;7.1</a>. (Сравните с <a class="ref" href="http://railstutorial.ru/chapters/4_0/a-demo-app#table-demo_RESTful_users">Таблицей&nbsp;2.2</a>.) В течение следующих трех глав, мы охватим остальные записи в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#table-RESTful_users">Таблице&nbsp;7.1</a> поскольку мы заполним все действия, необходимые, для того, чтобы сделать Users RESTful ресурсом.</p>

<div class="label" id="table-RESTful_users"></div>


<div class="table"><div class="center">
<table class="tabular"><tbody><tr><th class="align_left"><strong>HTTP запрос</strong></th><th class="align_left"><strong>URL</strong></th><th class="align_left"><strong>Действие</strong></th><th class="align_left"><strong>Именованный маршрут</strong></th><th class="align_left"><strong>Назначение</strong></th></tr><tr class="top_bar"><td class="align_left"><tt>GET</tt></td><td class="align_left">/users</td><td class="align_left"><code>index</code></td><td class="align_left"><code>users_path</code></td><td class="align_left">страница показывающая список всех пользователей</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left">/users/1</td><td class="align_left"><code>show</code></td><td class="align_left"><code>user_path(user)</code></td><td class="align_left">страница показывающая пользователя</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left">/users/new</td><td class="align_left"><code>new</code></td><td class="align_left"><code>new_user_path</code></td><td class="align_left">страница для создания нового пользователя (регистрация)</td></tr><tr><td class="align_left"><tt>POST</tt></td><td class="align_left">/users</td><td class="align_left"><code>create</code></td><td class="align_left"><code>users_path</code></td><td class="align_left">создание нового пользователя</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left">/users/1/edit</td><td class="align_left"><code>edit</code></td><td class="align_left"><code>edit_user_path(user)</code></td><td class="align_left">страница для редактирования пользователя с id <code>1</code></td></tr><tr><td class="align_left"><tt>PATCH</tt></td><td class="align_left">/users/1</td><td class="align_left"><code>update</code></td><td class="align_left"><code>user_path(user)</code></td><td class="align_left">обновление пользователя</td></tr><tr><td class="align_left"><tt>DELETE</tt></td><td class="align_left">/users/1</td><td class="align_left"><code>destroy</code></td><td class="align_left"><code>user_path(user)</code></td><td class="align_left">удаление пользователя</td></tr></tbody></table></div><div class="caption"><span class="header">Table 7.1: </span><span class="description">RESTful маршруты, обеспеченные ресурсом Users в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-users_resource">Листинге&nbsp;7.3</a>.</span></div></div>


<p>С кодом в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-users_resource">Листинге&nbsp;7.3</a>, маршруты работают, но страница по-прежнему не существует (<a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-user_show_unknown_action_4">Рис.&nbsp;7.5</a>). Для того чтобы исправить это, мы начнем с минималистичной версии страницы профиля, которую мы откормим в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-a_gravatar_image">Разделе&nbsp;7.1.4</a>.</p>

<div class="label" id="fig-user_show_unknown_action_4"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/user_show_unknown_action_4.png" alt="user_show_unknown_action_4"></span></div><div class="caption"><span class="header">Рис. 7.5: </span><span class="description"> URL /users/1 с маршрутом, но без страницы.&nbsp;<a href="http://railstutorial.org/images/figures/user_show_unknown_action_4-full.png">(полный размер)</a></span></div></div>


<p>Мы будем использовать стандартное Rails размещение для представления показывающего пользователя, которым является <code>app/views/users/show.html.erb</code>. В отличие от представления <code>new.html.erb</code>, которое мы создали с помощью генератора в <a class="ref" href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#code-generate_users_controller">Листинге&nbsp;5.31</a>, файл <code>show.html.erb</code> в данный момент не существует, так что нам необходимо создать его вручную и заполнить его содержимым  <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-stub_user_view">Листинга&nbsp;7.4</a>.</p>

<div class="label" id="code-stub_user_view"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.4.</span> <span class="description">Представление-заглушка для отображения информации пользователя. <br> <code>app/views/users/show.html.erb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span>, <span class="cp">&lt;%=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">email</span> <span class="cp">%&gt;</span>
</pre></div>
</div></div>


<p>Это представление использует Embedded Ruby для отображения имени и адреса электронной почты пользователя, предполагая наличие переменной экземпляра  <code>@user</code>. Конечно же, в итоге реальная страница пользователя будет выглядеть совершенно иначе и не будет публично демонстрировать адрес электронной почты.</p>

<p>Для того чтобы заставить представление user show работать, нам необходимо определить переменную <code>@user</code> в соответствующем <code>show</code> действии контроллера Users. Как вы и ожидали, мы используем метод <code>find</code> на модели User (<a class="ref" href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-finding_user_objects">Раздел&nbsp;6.1.4</a>) для получения пользователя из базы данных, как это показано в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-user_show_action">Листинге&nbsp;7.5</a>.</p>

<div class="label" id="code-user_show_action"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.5.</span> <span class="description">Контроллер Users с действием <code>show</code> action. <br> <code>app/controllers/users_controller.rb</code></span></div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Здесь мы использовали <code>params</code> для получения id&nbsp;пользователя. Когда мы сделаем соответствующий запрос в контроллер Users, <code>params[:id]</code> будет пользовательским id&nbsp;<tt>1</tt>, так что эффект тот же что и с методом <code>find</code></p>

<div class="code"><div class="highlight"><pre><span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>


<p>который мы видели в <a class="ref" href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-finding_user_objects">Разделе&nbsp;6.1.4</a>. (Технически, <code>params[:id]</code> является строкой&nbsp;<code>"1"</code>, но <code>find</code> достаточно умен, чтобы преобразовать это в целое число.)</p>

<p>С представлением и определенным действием, URL <a href="http://localhost:3000/users/1">/users/1</a> работает замечательно (<a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-user_show_rails_3">Рис.&nbsp;7.6</a>). Обратите внимание что отладочная информация в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-user_show_rails_3">Рис.&nbsp;7.6</a> подтверждает значение <code>params[:id]</code>:</p>

<div class="code"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">show</span>
<span class="l-Scalar-Plain">controller</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">users</span>
<span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span> <span class="s">'1'</span>
</pre></div>
</div>


<p>Вот почему код</p>

<div class="code"><div class="highlight"><pre><span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</pre></div>
</div>


<p>в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-user_show_action">Листинге&nbsp;7.5</a> находит пользователя с id&nbsp;<tt>1</tt>.</p>

<div class="label" id="fig-user_show_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/user_show_bootstrap.png" alt="user_show_bootstrap"></span></div><div class="caption"><span class="header">Рис. 7.6: </span><span class="description">Страница показывающая пользователя на <a href="http://localhost:3000/users/1">/users/1</a> после добавления ресурса Users.&nbsp;<a href="http://railstutorial.org/images/figures/user_show_bootstrap-full.png">(полный размер)</a></span></div></div>



<div class="label" id="sec-tests_with_factories"></div>


<h3><a id="sec-7_1_3" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-tests_with_factories" class="heading"><span class="number">7.1.3</span> Тестирование страницы показывающей пользователя (с фабриками)</a></h3>


<p>Теперь, когда у нас есть минимально рабочий профиль, пришло время поработать над версией из наброска на <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-profile_mockup_profile_name">Рис.&nbsp;7.1</a>. Как и в случае с созданием статических страниц (<a class="ref" href="http://railstutorial.ru/chapters/4_0/static-pages#top">Глава&nbsp;3</a>) и моделью User (<a class="ref" href="http://railstutorial.ru/chapters/4_0/modeling-users#top">Глава&nbsp;6</a>), мы сделаем это используя разработку через тестирование.</p>

<p>Вспомните из <a class="ref" href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-signup_url">Раздела&nbsp;5.4.2</a> что для страниц связанных с ресурсом Users мы приняли решение использовать интеграционные тесты. В случае со страницей регистрации, наш тест вначале посещает <code>signup_path</code> а затем проверяет правильность <code>h1</code> и <code>title</code> тегов, как это показано в <a class="ref" href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#code-user_pages_spec">Листинге&nbsp;5.34</a> и повторено в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-initial_signup_test">Листинге&nbsp;7.6</a>. (Обратите внимание, что мы опустили <code>full_title</code> хелпер из <a class="ref" href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-pretty_rspec">Раздела&nbsp;5.3.4</a> поскольку полный заголовок уже адекватно протестирован.)</p>

<div class="label" id="code-initial_signup_test"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.6.</span> <span class="description">Резюме начального спека страниц пользователя. <br> <code>spec/requests/user_pages_spec.rb</code></span></div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'spec_helper'</span>

<span class="n">describe</span> <span class="s2">"User pages"</span> <span class="k">do</span>

  <span class="n">subject</span> <span class="p">{</span> <span class="n">page</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s2">"signup page"</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">signup_path</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">'Sign up'</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_title</span><span class="p">(</span><span class="n">full_title</span><span class="p">(</span><span class="s1">'Sign up'</span><span class="p">))</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Для того чтобы протестировать страницу показывающую пользователя, нам необходим объект модели User для того чтобы коду в действии <code>show</code> (<a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-user_show_action">Листинг&nbsp;7.5</a>) было что искать:</p>

<div class="code"><div class="highlight"><pre><span class="n">describe</span> <span class="s2">"profile page"</span> <span class="k">do</span>
  <span class="c1"># Replace with code to make a user variable</span>
  <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">user_path</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_title</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>


<p>где нам нужно заполнить комментарий соответствующим кодом. Здесь используется именованный маршрут <code>user_path</code> (<a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#table-RESTful_users">Таблица&nbsp;7.1</a>) для генерации пути к странице показывающей данного пользователя. Затем мы тестируем что и страница и тайтл содержат имя пользователя.</p>

<p>Для того чтобы создать необходимый объект модели User, мы можем использовать Active Record для создания пользователя посредством <code>User.create</code>, но практика показывает, что пользовательские <em>фабрики</em> являются более удобным способом определения и вставки в базу данных объектов user. Мы будем использовать фабрики генерируемые <a href="http://github.com/thoughtbot/factory_girl">Factory Girl</a> - Ruby гемом который сделан хорошими людьми из <a href="http://thoughtbot.com/">thoughtbot</a>. Как и RSpec, Factory Girl определяет предметно-ориентированный язык в Ruby, в данном случае предназначенный для определения объектов Active Record. Синтаксис прост, опирается на  Ruby блоки и кастомные методы для определения атрибутов описываемого объекта. Для случаев вроде тех что мы увидим в этой главе, преимущество над Active Record может быть неочевидным, но мы будем использовать более продвинутые техники фабрик в последующих главах. Например, в <a class="ref" href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#sec-pagination">Разделе&nbsp;9.3.3</a> нам понадобится создать набор пользователей с уникальными адресами электронной почты и фабрики позволят нам проделать это с легкостью.</p>

<p>Как и с другими Ruby гемами, мы можем установить Factory Girl добавив строку в <code>Gemfile</code> используемый Bundler-ом (<a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-gemfile_factory_girl">Listing&nbsp;7.7</a>). (Поскольку Factory Girl нужна только в тестах, мы поместили ее в группу <code>:test</code>.)</p>

<div class="label" id="code-gemfile_factory_girl"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.7.</span> <span class="description">Добавление Factory Girl в <code>Gemfile</code>.</span></div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">'https://rubygems.org'</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="n">gem</span> <span class="s1">'factory_girl_rails'</span><span class="p">,</span> <span class="s1">'4.2.1'</span>
<span class="k">end</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
</pre></div>
</div></div>


<p>Затем устанавливаем как обычно:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install
</pre></div>
</div>


<p>Мы поместим все наши фабрики Factory Girl в файл <code>spec/factories.rb</code>, который автоматически будет загружен RSpec-ом. Код необходимый для создания фабрики User представлен в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-user_factory">Листинге&nbsp;7.8</a>.</p>

<div class="label" id="code-user_factory"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.8.</span> <span class="description">Фабрика для симуляции объектов модели User. <br> <code>spec/factories.rb</code></span></div>
<div class="code"><div class="highlight"><pre><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
  <span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
    <span class="nb">name</span>     <span class="s2">"Michael Hartl"</span>
    <span class="n">email</span>    <span class="s2">"michael@example.com"</span>
    <span class="n">password</span> <span class="s2">"foobar"</span>
    <span class="n">password_confirmation</span> <span class="s2">"foobar"</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>

<p>Передавая символ <code>:user</code> команде <code>factory</code>, мы говорим Factory Girl что последующее определение предназначено для объекта модели User.</p>

<p>С определением в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-user_factory">Листинге&nbsp;7.8</a>, мы можем создать фабрику User в тестах используя команду <code>let</code> (<a class="ref" href="http://railstutorial.ru/chapters/4_0/modeling-users#sidebar-let">Блок&nbsp;6.3</a>) и метода <code>FactoryGirl</code> поддерживаемого Factory Girl:</p>

<div class="code"><div class="highlight"><pre><span class="n">let</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">{</span> <span class="no">FactoryGirl</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>


<p>Конечный результат представлен в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-user_show_page_test">Листинге&nbsp;7.9</a>.</p>

<div class="label" id="code-user_show_page_test"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.9.</span> <span class="description">Тест для страницы показывающей пользователя. <br> <code>spec/requests/user_pages_spec.rb</code></span></div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'spec_helper'</span>

<span class="n">describe</span> <span class="s2">"User pages"</span> <span class="k">do</span>

  <span class="n">subject</span> <span class="p">{</span> <span class="n">page</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s2">"profile page"</span> <span class="k">do</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">{</span> <span class="no">FactoryGirl</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">user_path</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_title</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">"signup page"</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">signup_path</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">'Sign up'</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_title</span><span class="p">(</span><span class="n">full_title</span><span class="p">(</span><span class="s1">'Sign up'</span><span class="p">))</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>В этой точке вам необходимо проверить что набор тестов в красном:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/
</pre></div>
</div>


<p>Мы можем получить зеленые тесты с кодом из <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-name_title_and_heading">Листинга&nbsp;7.10</a>.</p>

<div class="label" id="code-name_title_and_heading"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.10.</span> <span class="description">Добавление заголовка браузера и заголовка первого уровня для страницы профиля пользователя. <br> <code>app/views/users/show.html.erb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="vi">@user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>
</pre></div>
</div></div>


<p>Повторный запуск тестов должен подтвердить что тесты из <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-user_show_page_test">Листинга&nbsp;7.9</a> теперь проходят:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/
</pre></div>
</div>


<p>Вы быстро заметите что тесты с Factory Girl -  <em>медленные</em>. И это происходит не по вине Factory Girl и фактически это <em>фича</em>, а не баг. Проблема связана с тем, что алгоритм BCrypt используемый в <a class="ref" href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-an_encrypted_password">Разделе&nbsp;6.3.1</a> для создания хэша безопасного пароля является медленным по своей природе: именно низкая скорость BCrypt отчасти делает его таким сложным для взлома. К сожалению, это означает что создание пользователей может утопить набор тестов; к счастью, есть простой способ исправить это. Библиотека <tt>bcrypt-ruby</tt> использует <em>фактор стоимости</em> для управления вычислительной сложностью создаваемого безопасного хэша. Дефолтное значение призвано обеспечить безопасность, а не скорость и для рабочих приложений это здорово, но в тестах наши потребности противоположны: мы хотим <em>быстрые</em> тесты и нас совершенно не тревожит безопасность хэшей паролей тестовых пользователей. Решением будет добавление строки которая переопределит фактор стоимости от дефолтного безопасного значения к минимально возможному в файл конфигурации тестового окружения <code>config/environments/test.rb</code>, как это показано в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-test_bcrypt_cost_factor">Листинге&nbsp;7.11</a>. Даже для небольшого набора тестов выигрыш в скорости от этого шага может быть весьма значительным и я настоятельно рекомендую включить <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-test_bcrypt_cost_factor">Листинг&nbsp;7.11</a> в ваш <code>test.rb</code> конфиг.</p>

<div class="label" id="code-test_bcrypt_cost_factor"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.11.</span> <span class="description">Переопределение фактора стоимости Bсrypt в тестовом окружении. <br> <code>config/environments/test.rb</code></span></div>
<div class="code"><div class="highlight"><pre><span class="ss">SampleApp::Application</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="c1"># Speed up tests by lowering bcrypt's cost function.</span>
  <span class="ss">ActiveModel::SecurePassword</span><span class="o">.</span><span class="n">min_cost</span> <span class="o">=</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="sec-a_gravatar_image"></div>


<h3><a id="sec-7_1_4" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-a_gravatar_image" class="heading"><span class="number">7.1.4</span> Изображение Gravatar и боковая панель</a></h3>


<p>Определив базовую страницу пользователя в предыдущем разделе, теперь мы немного улучшим ее, добавив изображение пользователя и начальную реализацию боковой панели пользователя. При создании страницы мы сфокусируемся на ее внешнем виде, не особо заботясь о ее структуре, это означает, что (по крайней мере пока) мы не будем писать тесты. Когда мы подойдем к аспектам представления, более подверженным ошибкам, таким как пагинация (<a class="ref" href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#sec-pagination">Раздел&nbsp;9.3.3</a>), мы продолжим разработку через тестирование.</p>

<p>Мы начнем с добавления “глобально распознаваемого аватара” (также известного как <a href="http://gravatar.com/">Граватар</a>) к профилю пользователя.<sup class="footnote" id="fnref-7_6"><a href="http://railstutorial.ru/chapters/4_0/sign-up#fn-7_6">6</a></sup> Автором Граватар является Tom Preston-Werner (сооснователь <a href="http://github.com/">GitHub</a>), впоследствии его (Граватар) приобрела компания <a href="http://automattic.com/">Automattic</a> (создатели <a href="http://wordpress.com/">WordPress</a>), это бесплатный сервис который позволяет пользователям загружать изображения и связывать их с подконтрольными им адресами электронной почты. Gravatar это удобный способ добавить изображения пользователей не связываясь с проблемами загрузки изображений, их обрезкой и хранением; все что нам нужно, это создать правильный URL Gravatar изображения используя адрес электронной почты пользователя и соответствующее изображение Gravatar появится автоматически.<sup class="footnote" id="fnref-7_7"><a href="http://railstutorial.ru/chapters/4_0/sign-up#fn-7_7">7</a></sup></p>

<p>Мы планируем определить вспомогательную функцию <code>gravatar_for</code> которая будет возвращать изображение Граватар для данного пользователя, как это показано в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-user_show_view_with_gravatar">Листинге&nbsp;7.12</a>.</p>

<div class="label" id="code-user_show_view_with_gravatar"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.12.</span> <span class="description">Представление показывающее пользователя с именем и Граватаром. <br> <code>app/views/users/show.html.erb</code></span></div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="vi">@user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h1&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">gravatar_for</span> <span class="vi">@user</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/h1&gt;</span>
</pre></div>
</div></div>


<p>В этой точке вы можете проверить что набор тестов не проходит:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/
</pre></div>
</div>


<p>Из-за того что метод <code>gravatar_for</code> неопределен, страница показывающая пользователя в настоящий момент не работает. (Отлов подобных ошибок это, возможно самый полезный аспект тестов представлений. Вот почему так важно наличие <em>хоть каких-то</em> тестов представлений, даже минималистичных.)</p>

<p>По умолчанию, методы определеннные в любом файле хелпера являются автоматически доступным в любом представлении, но для удобства мы поместим метод <code>gravatar_for</code> в файл для хелперов, связанных с контроллером Users. Как  <a href="http://en.gravatar.com/site/implement/hash/">отмечено на главной странице Граватар</a>, URL Граватара основывается на <a href="http://ru.wikipedia.org/wiki/MD5">MD5 хэше</a> адреса электронной почты пользователя. В Ruby, алгоритм MD5 хэширования реализутся с помощью метода <code>hexdigest</code>, который является частью библиотеки <code>Digest</code>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">email</span> <span class="o">=</span> <span class="s2">"MHARTL@example.COM"</span><span class="o">.</span>
<span class="gp">&gt;&gt; </span><span class="ss">Digest::MD5</span><span class="o">::</span><span class="n">hexdigest</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">downcase</span><span class="p">)</span>
<span class="go">=&gt; "1fda4469bcbec3badf5418269ffc5968" </span>
</pre></div>
</div>


<p>Поскольку адреса электронной почты нечувствительны к регистру (<a class="ref" href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-format_validation">Раздел&nbsp;6.2.4</a>), в отличие от MD5 хэшей, мы используем метод <code>downcase</code> для того чтобы быть уверенными в том, что аргумент передаваемый в <code>hexdigest</code> находится в нижнем регистре. Получившийся  хелпер <code>gravatar_for</code> представлен в  <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-gravatar_for_helper">Листинге&nbsp;7.13</a>.</p>

<div class="label" id="code-gravatar_for_helper"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.13.</span> <span class="description">Определение вспомогательного метода <code>gravatar_for</code>. <br> <code>app/helpers/users_helper.rb</code></span></div>
<div class="code"><div class="highlight"><pre><span class="k">module</span> <span class="nn">UsersHelper</span>

  <span class="c1"># Returns the Gravatar (http://gravatar.com/) for the given user.</span>
  <span class="k">def</span> <span class="nf">gravatar_for</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="n">gravatar_id</span> <span class="o">=</span> <span class="ss">Digest::MD5</span><span class="o">::</span><span class="n">hexdigest</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">downcase</span><span class="p">)</span>
    <span class="n">gravatar_url</span> <span class="o">=</span> <span class="s2">"https://secure.gravatar.com/avatar/</span><span class="si">#{</span><span class="n">gravatar_id</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">image_tag</span><span class="p">(</span><span class="n">gravatar_url</span><span class="p">,</span> <span class="ss">alt:</span> <span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="ss">class:</span> <span class="s2">"gravatar"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Код в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-gravatar_for_helper">Листинге&nbsp;7.13</a> возвращает тег <code>img</code> для Граватара с классом <code>"gravatar"</code> и альтернативным текстом эквивалентным имени пользователя (что особенно удобно для браузеров используемых слабовидящими людьми которые работают с помощью считывателей экрана). Вы можете проверить что теперь набор тестов проходит:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/
</pre></div>
</div>


<p>Страница профиля представленная на <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-profile_with_gravatar">Рис.&nbsp;7.7</a>, показывающая дефолтное изображение Граватара, выглядит подобным образом т.к. <code>user@example.com</code> это невалидный email адрес (домен <a href="http://example.com/">example.com</a> зарезервирован для примеров (examples).</p>

<div class="label" id="fig-profile_with_gravatar"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/profile_with_gravatar_bootstrap_4_0.png" alt="profile_with_gravatar_bootstrap_4_0"></span></div><div class="caption"><span class="header">Рис. 7.7: </span><span class="description">Страница профиля пользователя  <a href="http://localhost:3000/users/1">/users/1</a> с дефолтным Граватаром.&nbsp;<a href="http://railstutorial.org/images/figures/profile_with_gravatar_bootstrap_4_0-full.png">(полный размер)</a></span></div></div>


<p>Для того чтобы отобразить кастомный Граватар в нашем приложении, мы будем использовать <code>update_attributes</code> (<a class="ref" href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-updating_user_objects">Раздел&nbsp;6.1.5</a>) для обновления пользователя в базе данных:</p>

<div class="code"><div class="highlight"><pre><span class="go">$ rails console</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">first</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">update_attributes</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Example User"</span><span class="p">,</span>
<span class="gp">?&gt; </span>                       <span class="ss">email:</span> <span class="s2">"example@railstutorial.org"</span><span class="p">,</span>
<span class="gp">?&gt; </span>                       <span class="ss">password:</span> <span class="s2">"foobar"</span><span class="p">,</span>
<span class="gp">?&gt; </span>                       <span class="ss">password_confirmation:</span> <span class="s2">"foobar"</span><span class="p">)</span>
<span class="go">=&gt; true</span>
</pre></div>
</div>


<p>Здесь мы назначили пользователю адрес электронной почты <code>example@railstutorial.org</code>, который я связал с логотипом Rails Tutorial, как это видно на <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-profile_custom_gravatar">Рис.&nbsp;7.8</a>.</p>

<div class="label" id="fig-profile_custom_gravatar"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/profile_custom_gravatar_bootstrap_4_0.png" alt="profile_custom_gravatar_bootstrap_4_0"></span></div><div class="caption"><span class="header">Рис. 7.8: </span><span class="description">Страница показывающая пользователя с кастомным Граватаром.&nbsp;<a href="http://railstutorial.org/images/figures/profile_custom_gravatar_bootstrap_4_0-full.png">(полный размер)</a></span></div></div>


<p>Последний элемент, необходимый для завершения наброска из <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-profile_mockup_profile_name">Рис.&nbsp;7.1</a> это начальная версия пользовательской боковой панели. Мы реализуем ее с помощью тега <code>aside</code>, который используется для элементов (таких как сайдбары), которые дополняют страницу, но также могут быть использованы отдельно. Мы включаем <code>row</code> и <code>span4</code> классы, которые являются частью Bootstrap. Код для измененной страницы показывающей пользователя представлен в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-user_show_with_sidebar">Листинге&nbsp;7.14</a>.</p>

<div class="label" id="code-user_show_with_sidebar"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.14.</span> <span class="description">Добавление боковой панели к представлению user <code>show</code>. <br> <code>app/views/users/show.html.erb</code></span></div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="vi">@user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;aside</span> <span class="na">class=</span><span class="s">"span4"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;section&gt;</span>
      <span class="nt">&lt;h1&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">gravatar_for</span> <span class="vi">@user</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;/section&gt;</span>
  <span class="nt">&lt;/aside&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div></div>


<p>Имея соответствующие HTML элементы и CSS классы, мы можем отстилить страницу профиля (включая боковую панель и Gravatar) с SCSS показанным в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-sidebar_css">Листинге&nbsp;7.15</a>. (Обратите внимание на наследование CSS правил, которое работает только благодаря препроцессору Sass, используемому файлопроводом.) Получившаяся страница показана на <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-user_show_sidebar_css">Рис.&nbsp;7.9</a>.</p>

<div class="label" id="code-sidebar_css"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.15.</span> <span class="description">SCSS для стилизации страницы показывающей пользователя, включая боковую панель. <br> <code>app/assets/stylesheets/custom.css.scss</code></span></div>
<div class="code"><div class="highlight"><pre><span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>

<span class="o">/*</span> <span class="nt">sidebar</span> <span class="o">*/</span>

<span class="nt">aside</span> <span class="p">{</span>
  <span class="nt">section</span> <span class="p">{</span>
    <span class="na">padding</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span> <span class="mi">0</span><span class="p">;</span>
    <span class="na">border-top</span><span class="o">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="no">solid</span> <span class="nv">$grayLighter</span><span class="p">;</span>
    <span class="k">&amp;</span><span class="nd">:first-child</span> <span class="p">{</span>
      <span class="na">border</span><span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="na">padding-top</span><span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nt">span</span> <span class="p">{</span>
      <span class="na">display</span><span class="o">:</span> <span class="no">block</span><span class="p">;</span>
      <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">3</span><span class="kt">px</span><span class="p">;</span>
      <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nt">h1</span> <span class="p">{</span>
      <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.4</span><span class="kt">em</span><span class="p">;</span>
      <span class="na">text-align</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
      <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
      <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">3</span><span class="kt">px</span><span class="p">;</span>
      <span class="na">margin-top</span><span class="o">:</span> <span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nc">.gravatar</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="na">margin-right</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div></div>




<div class="label" id="fig-user_show_sidebar_css"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/user_show_sidebar_css_bootstrap.png" alt="user_show_sidebar_css_bootstrap"></span></div><div class="caption"><span class="header">Рис. 7.9: </span><span class="description">Страница показывающая пользователя  <a href="http://localhost:3000/users/1">/users/1</a> с боковой панелью и CSS.&nbsp;<a href="http://railstutorial.org/images/figures/user_show_sidebar_css_bootstrap-full.png">(полный размер)</a></span></div></div>




<div class="label" id="sec-signup_form"></div>


<h2><a id="sec-7_2" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-signup_form" class="heading"><span class="number">7.2</span> Форма регистрации</a></h2>


<p>Теперь, когда у нас есть рабочая (хоть и незавершенная) страница профиля пользователя, мы готовы приступить к созданию формы для регистрации на нашем сайте. Мы видели на <a class="ref" href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#fig-new_signup_page">Рис.&nbsp;5.9</a> (дублированном на <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-blank_signup_page_recap">Рис.&nbsp;7.10</a>) что страница регистрации в настоящий момент пуста и совершенно бесполезна для регистрации новых пользователей. Целью этого раздела является разработка формы регистрации из <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-signup_mockup">Рис.&nbsp;7.11</a>.</p>

<div class="label" id="fig-blank_signup_page_recap"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/new_signup_page_bootstrap.png" alt="new_signup_page_bootstrap"></span></div><div class="caption"><span class="header">Рис. 7.10: </span><span class="description">Текущее состояние страницы регистрации  <a href="http://localhost:3000/signup">/signup</a>.&nbsp;<a href="http://railstutorial.org/images/figures/new_signup_page_bootstrap-full.png">(полный размер)</a></span></div></div>




<div class="label" id="fig-signup_mockup"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/signup_mockup_bootstrap.png" alt="signup_mockup_bootstrap"></span></div><div class="caption"><span class="header">Рис. 7.11: </span><span class="description">Набросок страницы регистрации пользователей.&nbsp;<a href="http://railstutorial.org/images/figures/signup_mockup_bootstrap-full.png">(полный размер)</a></span></div></div>


<p>Поскольку мы говорим о создании пользователей через веб-интерфейс, давайте удалим пользователя созданного через консоль в <a class="ref" href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-creating_a_user">Разделе&nbsp;6.3.5</a>. Простейшим способом сделать это является очистка базы данных с помощью Rake-задачи <code>db:reset</code>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rake db:reset
</pre></div>
</div>


<p>После очистки базы данных на некоторых системах также необходимо заново подготовить тестовую базу данных:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rake <span class="nb">test</span>:prepare
</pre></div>
</div>


<p>Наконец, на некоторых системах вам может потребоваться перезагрузка сервера для того чтобы изменения вступили в силу.<sup class="footnote" id="fnref-7_8"><a href="http://railstutorial.ru/chapters/4_0/sign-up#fn-7_8">8</a></sup></p>

<div class="label" id="sec-tests_for_user_signup"></div>


<h3><a id="sec-7_2_1" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-tests_for_user_signup" class="heading"><span class="number">7.2.1</span> Тесты для регистрации пользователя</a></h3>


<p>До появления мощных веб-фреймворков с полным набором тестировочных средств, тестирование часто доставляло много хлопот. Например, для тестирования страницы регистрации вручную, нам бы пришлось посещать страницу в браузере, затем заполнять форму различными валидными и невалидными данными и проверять что в каждом случае поведение приложения соответствует ожидаемому. Кроме того, нам бы пришлось проделывать это каждый раз при изменении приложения. С помощью RSpec и Capybara мы сможем написать выразительные тесты, которые автоматизируют задачи, которые раньше делались вручную.</p>

<p>Мы уже видели как Capybara поддерживает интуитивно понятный синтаксис веб-навигации. До сих пор мы в основном использовали <code>visit</code> для посещения конкретных страниц, но Capybara может гораздо больше, включая заполнение полей, вроде тех что мы видели на <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-signup_mockup">Рис.&nbsp;7.11</a> и кликанья по кнопке. Синтаксис выглядит примерно так:</p>

<div class="code"><div class="highlight"><pre><span class="n">visit</span> <span class="n">signup_path</span>
<span class="n">fill_in</span> <span class="s2">"Name"</span><span class="p">,</span> <span class="ss">with:</span> <span class="s2">"Example User"</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="n">click_button</span> <span class="s2">"Create my account"</span>
</pre></div>
</div>


<p>Сейчас нашей целью является написание тестов для правильного поведения при предоставлении невалидной и валидной регистрационной информации. Поскольку эти тесты довольно продвинутые, мы будем писать их постепенно. Если вам интересно посмотреть как они работают (включая файл в который они должны быть помещены), вы можете перейти непосредственно к <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-basic_signup_tests">Листингу&nbsp;7.16</a>.</p>

<p>Наша первая задача это тестирование провальной отправки регистрационной формы, и мы можем симулировать отправку невалидных данных посетив страницу и кликнув по кнопке с помощью <code>click_button</code>:</p>

<div class="code"><div class="highlight"><pre><span class="n">visit</span> <span class="n">signup_path</span>
<span class="n">click_button</span> <span class="s2">"Create my account"</span>
</pre></div>
</div>


<p>Это эквивалентно посещению страницы регистрации и отправке формы незаполненной регистрационной информацией. Аналогично, для симуляции отправки валидных данных, мы заполняем форму валидными данными с помощью <code>fill_in</code>:</p>

<div class="code"><div class="highlight"><pre><span class="n">visit</span> <span class="n">signup_path</span>
<span class="n">fill_in</span> <span class="s2">"Name"</span><span class="p">,</span>         <span class="ss">with:</span> <span class="s2">"Example User"</span>
<span class="n">fill_in</span> <span class="s2">"Email"</span><span class="p">,</span>        <span class="ss">with:</span> <span class="s2">"user@example.com"</span>
<span class="n">fill_in</span> <span class="s2">"Password"</span><span class="p">,</span>     <span class="ss">with:</span> <span class="s2">"foobar"</span>
<span class="n">fill_in</span> <span class="s2">"Confirmation"</span><span class="p">,</span> <span class="ss">with:</span> <span class="s2">"foobar"</span>
<span class="n">click_button</span> <span class="s2">"Create my account"</span>
</pre></div>
</div>


<p>Эти тесты проверяют что поведение приложения после клика по кнопке “Create my account” соответствует нашим ожиданиям: создается новый пользователь если информация валидна и не создается новый пользователь в случае когда она невалидна. Для того чтобы сделать это мы проверяем <em>количество</em> пользователей и наши тесты будут использовать метод <code>count</code>, доступный для каждого класса Active Record, включая <code>User</code>:</p>

<div class="code"><div class="highlight"><pre><span class="go">$ rails console</span>
<span class="gp">&gt;&gt; </span><span class="no">User</span><span class="o">.</span><span class="n">count</span>
<span class="go">=&gt; 0</span>
</pre></div>
</div>


<p>Здесь <code>User.count</code> является <code>0</code> поскольку мы очистили базу данных в начале этого раздела.</p>

<p>При отправке невалидных данных, мы ожидаем что количество пользователей не будет изменено; при отправке валидных данных мы ожидаем что оно изменится на 1. Мы можем выразить это в RSpec скомбинировав метод <code>expect</code> с методом <code>to</code> или методом <code>not_to</code>. Мы начнем со случая с невалидными данными поскольку он проще; мы посетим страницу регистрации и кликнем по кнопке, и мы ожидаем что это <em>не</em> изменит количества пользователей:</p>

<div class="code"><div class="highlight"><pre><span class="n">visit</span> <span class="n">signup_path</span>
<span class="n">expect</span> <span class="p">{</span> <span class="n">click_button</span> <span class="s2">"Create my account"</span> <span class="p">}</span><span class="o">.</span><span class="n">not_to</span> <span class="n">change</span><span class="p">(</span><span class="no">User</span><span class="p">,</span> <span class="ss">:count</span><span class="p">)</span>
</pre></div>
</div>


<p>Обратите внимание: <code>expect</code> обворачивает <code>click_button</code> в блок (<a class="ref" href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-blocks">Раздел&nbsp;4.3.2</a>). Что необходимо для работы метода <code>change</code>, который принимает в качестве аргумента объект и символ, а затем вычисляет результат вызова этого символа в качестве метода на объекте до и после блока. Другими словами, код</p>

<div class="code"><div class="highlight"><pre><span class="n">expect</span> <span class="p">{</span> <span class="n">click_button</span> <span class="s2">"Create my account"</span> <span class="p">}</span><span class="o">.</span><span class="n">not_to</span> <span class="n">change</span><span class="p">(</span><span class="no">User</span><span class="p">,</span> <span class="ss">:count</span><span class="p">)</span>
</pre></div>
</div>


<p>вычисляет</p>

<div class="code"><div class="highlight"><pre><span class="no">User</span><span class="o">.</span><span class="n">count</span>
</pre></div>
</div>


<p>до и после выполнения</p>

<div class="code"><div class="highlight"><pre><span class="n">click_button</span> <span class="s2">"Create my account"</span>
</pre></div>
</div>


<p>В данном случае, мы хотим чтобы данный код <em>не</em> изменял количества, что мы можем выразить с помощью метода <code>not_to</code>. В результате, закрыв клик по кнопке в блоке, мы можем заменить</p>

<div class="code"><div class="highlight"><pre><span class="n">initial</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">count</span>
<span class="n">click_button</span> <span class="s2">"Create my account"</span>
<span class="n">final</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">count</span>
<span class="n">expect</span><span class="p">(</span><span class="n">initial</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span> <span class="n">final</span>
</pre></div>
</div>


<p>на одну строку</p>

<div class="code"><div class="highlight"><pre><span class="n">expect</span> <span class="p">{</span> <span class="n">click_button</span> <span class="s2">"Create my account"</span> <span class="p">}</span><span class="o">.</span><span class="n">not_to</span> <span class="n">change</span><span class="p">(</span><span class="no">User</span><span class="p">,</span> <span class="ss">:count</span><span class="p">)</span>
</pre></div>
</div>


<p>которая читается как естественный язык и является намного более компактной (<code>eq</code> это RSpec метод для тестирования на равенство).</p>

<p>Случай с валидными данными аналогичен, но вместо проверки того, что количество пользователей не изменилось, мы проверяем что клик по кнопке изменяет их количество на 1:</p>

<div class="code"><div class="highlight"><pre><span class="n">visit</span> <span class="n">signup_path</span>
<span class="n">fill_in</span> <span class="s2">"Name"</span><span class="p">,</span>         <span class="ss">with:</span> <span class="s2">"Example User"</span>
<span class="n">fill_in</span> <span class="s2">"Email"</span><span class="p">,</span>        <span class="ss">with:</span> <span class="s2">"user@example.com"</span>
<span class="n">fill_in</span> <span class="s2">"Password"</span><span class="p">,</span>     <span class="ss">with:</span> <span class="s2">"foobar"</span>
<span class="n">fill_in</span> <span class="s2">"Confirmation"</span><span class="p">,</span> <span class="ss">with:</span> <span class="s2">"foobar"</span>
<span class="n">expect</span> <span class="k">do</span>
  <span class="n">click_button</span> <span class="s2">"Create my account"</span>
<span class="k">end</span><span class="o">.</span><span class="n">to</span> <span class="n">change</span><span class="p">(</span><span class="no">User</span><span class="p">,</span> <span class="ss">:count</span><span class="p">)</span><span class="o">.</span><span class="n">by</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>


<p>Здесь используется метод <code>to</code> поскольку мы ожидаем что клик по кнопке (вкупе с валидными данными) изменит количество пользователей на единицу.</p>

<p>Комбинирование двух случаев с соответствующими блоками <code>describe</code> и выталкивание общего кода в блоки <code>before</code>, приводит нас к хорошим базовым тестам для регистрации пользователей, как это показано в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-basic_signup_tests">Листинге&nbsp;7.16</a>. Здесь мы вынесли общий текст для кнопки регистрации в переменную <code>submit</code>, которую мы определили с помощью метода <code>let</code>.</p>

<div class="label" id="code-basic_signup_tests"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.16.</span> <span class="description">Хорошие базовые тесты для регистрации пользователей. <br> <code>spec/requests/user_pages_spec.rb</code></span></div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'spec_helper'</span>

<span class="n">describe</span> <span class="s2">"User pages"</span> <span class="k">do</span>

  <span class="n">subject</span> <span class="p">{</span> <span class="n">page</span> <span class="p">}</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="n">describe</span> <span class="s2">"signup page"</span> <span class="k">do</span>

    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">signup_path</span> <span class="p">}</span>

    <span class="n">let</span><span class="p">(</span><span class="ss">:submit</span><span class="p">)</span> <span class="p">{</span> <span class="s2">"Create my account"</span> <span class="p">}</span>

    <span class="n">describe</span> <span class="s2">"with invalid information"</span> <span class="k">do</span>
      <span class="n">it</span> <span class="s2">"should not create a user"</span> <span class="k">do</span>
        <span class="n">expect</span> <span class="p">{</span> <span class="n">click_button</span> <span class="n">submit</span> <span class="p">}</span><span class="o">.</span><span class="n">not_to</span> <span class="n">change</span><span class="p">(</span><span class="no">User</span><span class="p">,</span> <span class="ss">:count</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">describe</span> <span class="s2">"with valid information"</span> <span class="k">do</span>
      <span class="n">before</span> <span class="k">do</span>
        <span class="n">fill_in</span> <span class="s2">"Name"</span><span class="p">,</span>         <span class="ss">with:</span> <span class="s2">"Example User"</span>
        <span class="n">fill_in</span> <span class="s2">"Email"</span><span class="p">,</span>        <span class="ss">with:</span> <span class="s2">"user@example.com"</span>
        <span class="n">fill_in</span> <span class="s2">"Password"</span><span class="p">,</span>     <span class="ss">with:</span> <span class="s2">"foobar"</span>
        <span class="n">fill_in</span> <span class="s2">"Confirmation"</span><span class="p">,</span> <span class="ss">with:</span> <span class="s2">"foobar"</span>
      <span class="k">end</span>

      <span class="n">it</span> <span class="s2">"should create a user"</span> <span class="k">do</span>
        <span class="n">expect</span> <span class="p">{</span> <span class="n">click_button</span> <span class="n">submit</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">change</span><span class="p">(</span><span class="no">User</span><span class="p">,</span> <span class="ss">:count</span><span class="p">)</span><span class="o">.</span><span class="n">by</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Мы будем добавлять тесты по мере надобности в последующих разделах, но базовые тесты в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-basic_signup_tests">Листинге&nbsp;7.16</a> уже покрывают внушительный объем функционала. Для того чтобы получить их прохождение, мы должны создать страницу регистрации с необходимым минимумом правильных элементов, предопределить направление пользователя в правильное место после отправки формы и создание нового пользователя в базе данных только в случае если полученная информация валидна.</p>

<p>Конечно же, в этой точке тесты должны быть провальными:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/
</pre></div>
</div>




<div class="label" id="sec-using_form_for"></div>


<h3><a id="sec-7_2_2" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-using_form_for" class="heading"><span class="number">7.2.2</span> Применение <tt>form_for</tt></a></h3>


<p>Теперь, когда у нас есть хорошие провальные тесты для регистрации пользователя, мы начнем добиваться их прохождения, для начала создав <em>форму</em> для регистрации пользователей. Мы можем сделать это в Rails с помощью вспомогательного метода <code>form_for</code> который принимает объект Active Record и конструирует форму используя атрибуты объекта. Результат представлен в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-signup_form">Листинге&nbsp;7.17</a>. (Читатели знакомые с  Rails&nbsp;2.x должны обратить внимание что <code>form_for</code> использует “процент-равно” ERb синтаксис для вставки контента; там где Rails&nbsp;2.x использовали <tt class="verb">&lt;% form_for ... %&gt;</tt>, мы теперь используем <tt class="verb">&lt;%= form_for ... %&gt;</tt>.)</p>

<div class="label" id="code-signup_form"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.17.</span> <span class="description">Форма для регистрации новых пользователей. <br> <code>app/views/users/new.html.erb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s1">'Sign up'</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h1&gt;</span>Sign up<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"span6 offset3"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:email</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:email</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:password</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">password_field</span> <span class="ss">:password</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:password_confirmation</span><span class="p">,</span> <span class="s2">"Confirmation"</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">password_field</span> <span class="ss">:password_confirmation</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s2">"Create my account"</span><span class="p">,</span> <span class="ss">class:</span> <span class="s2">"btn btn-large btn-primary"</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div></div>


<p>Давайте рассмотрим этот код по частям. Наличие ключевого слова <code>do</code> указывает на то что <code>form_for</code> принимает блок с одной переменной, которую мы назвали <code>f</code> (от “form”):</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
  .
  .
  .
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>Как это зачастую происходит с хелперами Rails, нам нет надобности знать о подробностях реализации, но нам <em>необходимо</em> знать что делает  объект <code>f</code>: при вызове с методом соответствующим <a href="http://www.w3schools.com/html/html_forms.asp">элементу HTML формы</a> — таким как текстовое поле, радио кнопка, или поле пароля — он возвращает особым образом организованный код для этого элемента для установки атрибута объекта <code>@user</code>. Другими словами,</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>создает HTML необходимый для создания элемента маркированного текстового поля для назначения атрибута <code>name</code> модели User. (Мы взглянем на сам  HTML в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-the_form_html">Разделе&nbsp;7.2.3</a>.)</p>

<p>Для того чтобы увидеть это в действии нам необходимо посмотреть на HTML производимый этой формой, но здесь мы сталкиваемся с проблемой: страница в настоящее время сломана, поскольку мы не установили переменную <code>@user</code> — как все неопределенные переменные экземпляра (<a class="ref" href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-a_user_class">Раздел&nbsp;4.4.5</a>), <code>@user</code> в настоящее время является <code>nil</code>. Соответственно, если вы запустите ваш набор тестов в этой точке, вы увидите что тесты для содержимого страницы регистрации из  <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-initial_signup_test">Листинга&nbsp;7.6</a> сейчас не проходят:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/user_pages_spec.rb -e <span class="s2">"signup page"</span>
</pre></div>
</div>


<p>(Флаг <code>-e</code> в данном случае позволяет запустить только спеки, чье описание совпадает с <code>"signup page"</code>. В частности, обратите внимание что это <em>не</em> подстрока <code>"signup"</code>, что привело бы к запуску всех тестов в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-basic_signup_tests">Листинге&nbsp;7.16</a>.) Для того чтобы вновь сделать эти тесты проходящими и для того чтобы отрендерить нашу форму, мы должны определить переменную <code>@user</code> в действии контроллера, соответствующем  <code>new.html.erb</code>, т.е., в действии <code>new</code> контроллера Users. Хелпер <code>form_for</code> ожидает что <code>@user</code> будет объектом User и поскольку мы создаем  <em>нового</em> пользователя, мы просто используем <code>User.new</code>, как это видно в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-new_action_with_user">Листинге&nbsp;7.18</a>.</p>

<div class="label" id="code-new_action_with_user"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.18.</span> <span class="description">Добавление переменной <code>@user</code> в действие <code>new</code>. <br> <code>app/controllers/users_controller.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>После определения переменной <code>@user</code>, тесты для страницы регистрации должны пройти:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/user_pages_spec.rb -e <span class="s2">"signup page"</span>
</pre></div>
</div>


<p>В этой точке у нас должна получиться форма (со стилями из <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-form_css">Листинга&nbsp;7.19</a>) выглядящая как на  <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-signup_form">Рис.&nbsp;7.12</a>. Обратите внимание на повторное использование примеси <code>box_sizing</code> из <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-mixin_and_debug">Листинга&nbsp;7.2</a>.</p>

<div class="label" id="code-form_css"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.19.</span> <span class="description">CSS для формы регистрации. <br> <code>app/assets/stylesheets/custom.css.scss</code></span></div>
<div class="code"><div class="highlight"><pre><span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>

<span class="o">/*</span> <span class="nt">forms</span> <span class="o">*/</span>

<span class="nt">input</span><span class="o">,</span> <span class="nt">textarea</span><span class="o">,</span> <span class="nt">select</span><span class="o">,</span> <span class="nc">.uneditable-input</span> <span class="p">{</span>
  <span class="na">border</span><span class="o">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="no">solid</span> <span class="mh">#bbb</span><span class="p">;</span>
  <span class="na">width</span><span class="o">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">15</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">@include</span><span class="nd"> box_sizing</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">input</span> <span class="p">{</span>
  <span class="na">height</span><span class="o">:</span> <span class="no">auto</span> <span class="nv">!important</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div></div>




<div class="label" id="fig-signup_form"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/signup_form_bootstrap.png" alt="signup_form_bootstrap"></span></div><div class="caption"><span class="header">Рис. 7.12: </span><span class="description">Форма регистрации новых пользователей <a href="http://localhost:3000/signup">/signup</a>.&nbsp;<a href="http://railstutorial.org/images/figures/signup_form_bootstrap-full.png">(полный размер)</a></span></div></div>




<div class="label" id="sec-the_form_html"></div>


<h3><a id="sec-7_2_3" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-the_form_html" class="heading"><span class="number">7.2.3</span> HTML формы</a></h3>


<p>Как нам подсказывает <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-signup_form">Рис.&nbsp;7.12</a>, теперь страница регистрации рендерится как следует, что указывает на то, что код <code>form_for</code> в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-signup_form">Листинге&nbsp;7.17</a> производит валидный HTML. Если вы взглянете на HTML для сгенерированной формы (используя <a href="http://getfirebug.com/">Firebug</a> или функцию “просмотр исходного кода страницы” вашего браузера), вы должны увидеть разметку как в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-signup_form_html">Листинге&nbsp;7.20</a>. Хотя большая часть деталей несущественна для наших целей, давайте <a href="http://ru.wiktionary.org/wiki/%D1%83%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C">улучим</a> минутку и ознакомимся с наиболее важными частями ее структуры.</p>

<div class="label" id="code-signup_form_html"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.20.</span> <span class="description">HTML для формы на <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-signup_form">Рис.&nbsp;7.12</a>.</span></div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;form</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">action=</span><span class="s">"/users"</span> <span class="na">class=</span><span class="s">"new_user"</span>
      <span class="na">id=</span><span class="s">"new_user"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"user_name"</span><span class="nt">&gt;</span>Name<span class="nt">&lt;/label&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"user_name"</span> <span class="na">name=</span><span class="s">"user[name]"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="nt">/&gt;</span>

  <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"user_email"</span><span class="nt">&gt;</span>Email<span class="nt">&lt;/label&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"user_email"</span> <span class="na">name=</span><span class="s">"user[email]"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="nt">/&gt;</span>

  <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"user_password"</span><span class="nt">&gt;</span>Password<span class="nt">&lt;/label&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"user_password"</span> <span class="na">name=</span><span class="s">"user[password]"</span>
         <span class="na">type=</span><span class="s">"password"</span> <span class="nt">/&gt;</span>

  <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"user_password_confirmation"</span><span class="nt">&gt;</span>Confirmation<span class="nt">&lt;/label&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"user_password_confirmation"</span>
         <span class="na">name=</span><span class="s">"user[password_confirmation]"</span> <span class="na">type=</span><span class="s">"password"</span> <span class="nt">/&gt;</span>

  <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"btn btn-large btn-primary"</span> <span class="na">name=</span><span class="s">"commit"</span> <span class="na">type=</span><span class="s">"submit"</span>
         <span class="na">value=</span><span class="s">"Create my account"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div></div>


<p>(Здесь я опустил HTML связанный с <em>authenticity token</em>, который Rails автоматически включают для предотвращения определенного вида атак, назывемого  <em>подделка межсайтовых запросов</em> (CSRF). См <a href="http://stackoverflow.com/questions/941594/understand-rails-authenticity-token">введение в Rails authenticity token на Stack Overflow </a> если вас интересуют подробности того как это работает и почему это так важно.)</p>

<p>Мы начнем с внутренней структуры документа. Сравнивая <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-signup_form">Листинг&nbsp;7.17</a> с <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-signup_form_html">Листингом&nbsp;7.20</a>, мы видим что Embedded Ruby</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>производит HTML</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"user_name"</span><span class="nt">&gt;</span>Name<span class="nt">&lt;/label&gt;</span>
<span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"user_name"</span> <span class="na">name=</span><span class="s">"user[name]"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="nt">/&gt;</span>
</pre></div>
</div>

<p>и</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:password</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">password_field</span> <span class="ss">:password</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>производит HTML</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"user_password"</span><span class="nt">&gt;</span>Password<span class="nt">&lt;/label&gt;&lt;br</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"user_password"</span> <span class="na">name=</span><span class="s">"user[password]"</span> <span class="na">type=</span><span class="s">"password"</span> <span class="nt">/&gt;</span>
</pre></div>
</div>


<p>Как видно из <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-filled_in_form">Рис.&nbsp;7.13</a>, текстовые поля (<code>type="text"</code>) просто отображают их содержимое, в то время как поля паролей (<code>type="password"</code>) скрывают вводимое в целях безопасности, как это показано на <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-filled_in_form">Рис.&nbsp;7.13</a>.</p>

<div class="label" id="fig-filled_in_form"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/filled_in_form_bootstrap.png" alt="filled_in_form_bootstrap"></span></div><div class="caption"><span class="header">Рис. 7.13: </span><span class="description">Заполненная форма с <code>text</code> и <code>password</code> полями.&nbsp;<a href="http://railstutorial.org/images/figures/filled_in_form_bootstrap-full.png">(полный размер)</a></span></div></div>

<p>Как мы увидим в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-signup_success">Разделе&nbsp;7.4</a>, ключом к созданию пользователя является специальный <code>name</code> атрибут в каждом <code>input</code>:</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"user_name"</span> <span class="na">name=</span><span class="s">"user[name]"</span> <span class="na">-</span> <span class="na">-</span> <span class="na">-</span> <span class="nt">/&gt;</span>
.
.
.
<span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"user_password"</span> <span class="na">name=</span><span class="s">"user[password]"</span> <span class="na">-</span> <span class="na">-</span> <span class="na">-</span> <span class="nt">/&gt;</span>
</pre></div>
</div>


<p>Эти значения <code>name</code> позволяют Rails сконструировать хэш инициализации (через переменную <code>params</code>) для создания пользователей с использованием значений введеных пользователем, как мы это увидим в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-signup_failure">Разделе&nbsp;7.3</a>.</p>

<p>Второй важный элемент это сам тег <code>form</code>. Rails создает тег <code>form</code> используя объект <code>@user</code>: поскольку каждый объект в Ruby знает свой класс (<a class="ref" href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-constructors">Раздел&nbsp;4.4.1</a>), Rails определяет что <code>@user</code> принадлежит к классу <code>User</code>; кроме того, поскольку <code>@user</code> это <em>новый</em> пользователь, Rails знает что необходимо построить форму с <code>post</code> методом, который является правильным глаголом для создания нового объекта (<a class="ref" href="http://railstutorial.ru/chapters/4_0/static-pages#sidebar-get_etc">Блок&nbsp;3.3</a>):</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/users"</span> <span class="na">class=</span><span class="s">"new_user"</span> <span class="na">id=</span><span class="s">"new_user"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
</pre></div>
</div>


<p>Здесь атрибуты <code>class</code> и <code>id</code>, по большому счету, не имеют особого значения; более важными являются <code>action="/users"</code> и <code>method="post"</code>. Совместно они формируют инструкцию для отправки HTTP запроса <tt>POST</tt> на URL /users. В следующих двух разделах мы увидим к чему это приводит.</p>

<div class="label" id="sec-signup_failure"></div>


<h2><a id="sec-7_3" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-signup_failure" class="heading"><span class="number">7.3</span> Провальная регистрация</a></h2>


<p>Мы кратко рассмотрели HTML формы показанной на <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-signup_form">Рис.&nbsp;7.12</a> (<a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-signup_form_html">Листинг&nbsp;7.20</a>), теперь мы копнем эту тему чуть глубже. Так как HTML формы лучше всего понимается в контексте <em>сбоя регистрации</em>, в этом разделе мы создадим регистрационную форму которая принимает невалидные данные и вновь рендерит страницу регистрации со списком ошибок, как это показано на наброске <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-signup_failure_mockup">Рис.&nbsp;7.14</a>.</p>

<div class="label" id="fig-signup_failure_mockup"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/signup_failure_mockup_bootstrap.png" alt="signup_failure_mockup_bootstrap"></span></div><div class="caption"><span class="header">Рис. 7.14: </span><span class="description">Набросок страницы неудавшейся регистрации.&nbsp;<a href="http://railstutorial.org/images/figures/signup_failure_mockup_bootstrap-full.png">(полный размер)</a></span></div></div>




<div class="label" id="sec-a_working_form"></div>


<h3><a id="sec-7_3_1" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-a_working_form" class="heading"><span class="number">7.3.1</span> Рабочая форма</a></h3>


<p>Вспомните из <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-a_users_resource">Раздела&nbsp;7.1.2</a> что добавление <code>resources :users</code> в файл <code>routes.rb</code> (<a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-users_resource">Листинг&nbsp;7.3</a>) автоматически обеспечивает наше Rails приложение возможностью отвечать на RESTful URL из <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#table-RESTful_users">Таблицы&nbsp;7.1</a>. В частности, это приводит к тому, что <tt>POST</tt> запрос к /users обрабатывается действием <code>create</code>. Наша стратегия для действия <code>create</code> зaключается в использовании отправки формы для создания объекта нового пользователя с помощью <code>User.new</code>, попытке (провальной) сохранить этого пользователя и последующем рендеринге страницы регистрации для возможной повторной отправки формы. Давайте начнем с того что еще раз взглянем на код для формы регистрации:</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/users"</span> <span class="na">class=</span><span class="s">"new_user"</span> <span class="na">id=</span><span class="s">"new_user"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
</pre></div>
</div>


<p>Как было отмечено в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-the_form_html">Разделе&nbsp;7.2.3</a>, этот HTML выдает <tt>POST</tt> запрос к /users URL.</p>

<p>Нашим первым шагом на пути к зеленым тестам для невалидных данных из <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-basic_signup_tests">Листинга&nbsp;7.16</a> будет добавление кода из <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-first_create_action">Листинга&nbsp;7.21</a>. Этот листинг включает второе использование метода <code>render</code> который мы впервые видели в контексте партиалов (<a class="ref" href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-partials">Раздел&nbsp;5.1.3</a>); как вы можете видеть, <code>render</code> также работает и в действиях контроллера. Обратите внимание что мы воспользовались этой возможностью чтобы представить ветвящуюся структуру <code>if</code>-<code>else</code>, которая позволяет нам обрабатывать случаи сбоя и успеха раздельно, в зависимости от значения <code>@user.save</code>, которое (как мы видели в <a class="ref" href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-creating_user_objects">Разделе&nbsp;6.1.3</a>) может быть либо <code>true</code> либо <code>false</code> в зависимости от успешности сохранения.</p>

<div class="label" id="code-first_create_action"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.21.</span> <span class="description">Действие <code>create</code> которое может обрабатывать провальную регистрацию (но не успешную). <br> <code>app/controllers/users_controller.rb</code></span></div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:user</span><span class="o">]</span><span class="p">)</span>    <span class="c1"># Not the final implementation!</span>
    <span class="k">if</span> <span class="vi">@user</span><span class="o">.</span><span class="n">save</span>
      <span class="c1"># Handle a successful save.</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="s1">'new'</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Обратите внимание на комментарий: это не конечная реализация, но этого достаточно для начала. Мы закончим реализацию в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-strong_parameters">Разделе&nbsp;7.3.2</a>.</p>

<p>Лучший способ понять как работает код в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-first_create_action">Листинге&nbsp;7.21</a> это <em>отправить</em> форму с какими-нибудь невалидными регистрационными данными; результат представлен на <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-signup_failure">Рис.&nbsp;7.15</a> и полная отладочная информация (с увеличенным размером шрифта) представлена на <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-signup_failure_rails_debug">Рис.&nbsp;7.16</a>.</p>

<div class="label" id="fig-signup_failure"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/signup_failure_rails_4.png" alt="signup_failure_rails_4"></span></div><div class="caption"><span class="header">Рис. 7.15: </span><span class="description">Сбой регистрации.&nbsp;<a href="http://railstutorial.org/images/figures/signup_failure_rails_4-full.png">(полный размер)</a></span></div></div>




<div class="label" id="fig-signup_failure_rails_debug"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/signup_failure_rails_4_debug.png" alt="signup_failure_rails_4_debug"></span></div><div class="caption"><span class="header">Рис. 7.16: </span><span class="description">Отладочная информация сбоя регистрации.&nbsp;<a href="http://railstutorial.org/images/figures/signup_failure_rails_4_debug-full.png">(полный размер)</a></span></div></div>


<p>Чтобы получить более четкую картину того как Rails обрабатывает отправку регистрационных данных, давайте поближе познакомимся с <code>user</code> частью хэша параметров из отладочной информации (<a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-signup_failure_rails_debug">Рис.&nbsp;7.16</a>):</p>

<div class="code"><div class="highlight"><pre><span class="s2">"user"</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="s2">"Foo Bar"</span><span class="p">,</span>
            <span class="s2">"email"</span> <span class="o">=&gt;</span> <span class="s2">"foo@invalid"</span><span class="p">,</span>
            <span class="s2">"password"</span> <span class="o">=&gt;</span> <span class="s2">"[FILTERED]"</span><span class="p">,</span>
            <span class="s2">"password_confirmation"</span> <span class="o">=&gt;</span> <span class="s2">"[FILTERED]"</span>
          <span class="p">}</span>
</pre></div>
</div>


<p>Этот хэш передается в контроллер Users в качестве <code>params</code> и мы видели, начиная с <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-a_users_resource">Раздела&nbsp;7.1.2</a>, что хэш <code>params</code> содержит информацию о каждом запросе. В случае URL типа /users/1, значение <code>params[:id]</code> это <code>id</code> соответствующего пользователя (<code>1</code>&nbsp;в этом примере). В случае отправки регистрационной формы, <code>params</code> вместо этого содержит хэш хэшей, конструкцию, которую мы впервые видели в <a class="ref" href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-hashes_and_symbols">Разделе&nbsp;4.3.3</a>, который представил стратегически названную <code>params</code> переменную в консольной сессии. Эта отладочная информация показывает, что предоставление (отправка) формы дает в результате <code>user</code> хэш с атрибутами, соответствующими предоставленным значениям, где ключи происходят от <code>name</code> атрибутов тегов <code>input</code> которые мы видели в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-signup_form">Листинге&nbsp;7.17</a>; например, значение</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"user_email"</span> <span class="na">name=</span><span class="s">"user[email]"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="nt">/&gt;</span>
</pre></div>
</div>


<p>с именем <code>"user[email]"</code> это именно <code>email</code> атрибут хэша <code>user</code>.</p>

<p>Хотя хэш-ключи показаны в отладочном выводе в виде строк, в контроллер Users они передаются в виде символов, так что <code>params[:user]</code> на самом деле является хэшем атрибутов пользователя, именно тех атрибутов, что необходимы в качестве аргумента для <code>User.new</code>, как мы впервые видели в <a class="ref" href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-a_user_class">Разделе&nbsp;4.4.5</a> и как представлено в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-first_create_action">Листинге&nbsp;7.21</a>. Это означает, что строка</p>

<div class="code"><div class="highlight"><pre><span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:user</span><span class="o">]</span><span class="p">)</span>
</pre></div>
</div>


<p>практически эквивалентна</p>

<div class="code"><div class="highlight"><pre><span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Foo Bar"</span><span class="p">,</span> <span class="ss">email:</span> <span class="s2">"foo@invalid"</span><span class="p">,</span>
                 <span class="ss">password:</span> <span class="s2">"foo"</span><span class="p">,</span> <span class="ss">password_confirmation:</span> <span class="s2">"bar"</span><span class="p">)</span>
</pre></div>
</div>


<p>В предыдущих версиях Rails использование</p>

<div class="code"><div class="highlight"><pre><span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:user</span><span class="o">]</span><span class="p">)</span>
</pre></div>
</div>


<p>фактически работало, но было по умолчанию небезопасным, требовало особой тщательности при осуществлении довольно глючной процедуры имеющей своей целью защитить базу данных приложения от зловредных пользователей. В Rails&nbsp;4.0 этот код вызывает ошибку (как показано на <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-signup_failure">Рис.&nbsp;7.15</a> и <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-signup_failure_rails_debug">Рис.&nbsp;7.16</a> выше), что означает что он безопасен по умолчанию. Мы можем еще раз убедиться в этом проверив что соответствующие тесты не проходят:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/user_pages_spec.rb <span class="se">\</span>
<span class="gp">&gt;</span> -e <span class="s2">"signup with invalid information"</span>
</pre></div>
</div>




<div class="label" id="sec-strong_parameters"></div>


<h3><a id="sec-7_3_2" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-strong_parameters" class="heading"><span class="number">7.3.2</span> Строгие параметры</a></h3>


<p>В <a class="ref" href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-a_user_class">Разделе&nbsp;4.4.5</a> мы коротко упомянули об идее <em>массового назначения</em>, которая подразумевает инициализацию Ruby-переменной с хэшем значений:</p>

<div class="code"><div class="highlight"><pre><span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:user</span><span class="o">]</span><span class="p">)</span>    <span class="c1"># Not the final implementation!</span>
</pre></div>
</div>


<p>Комментарий включенный в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-first_create_action">Листинг&nbsp;7.21</a> и воспроизведенный выше указывает на то что это не финальная реализация. Причина по которой иниацилизация всего хэша <code>params</code> является <em>очень</em> опасной затеей заключается в том что это приводит к передаче в <code>User.new</code> <em>всех</em> данных отправленных пользователем. В частности, предположим что, в дополнение к текущим атрибутам, модель User включает в себя атрибут <code>admin</code> используемый для идентификации пользователей-администраторов сайта. (Мы реализуем именно такой атрибут в <a class="ref" href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#sec-administrative_users">Разделе&nbsp;9.4.1</a>.) Способом присвоить этому атрибуту значение <code>true</code> является передача значения <code>admin=’1’</code> как части <code>params[:user]</code>, этого легко достичь с помощью такого консольного HTTP клиента как <tt>curl</tt>. Таким образом, передавая весь хэш <code>params</code> в <code>User.new</code>, мы тем самым позволяем любому пользователю сайта получить права администратора включив <code>admin=’1’</code> в веб-запрос.</p>

<p>Для решения этой проблемы предыдущие версии Rails использовали метод <code>attr_accessible</code> на уровне <em>модели</em>, но в Rails&nbsp;4.0 более предпочтительной является техника с использованием так называемых <em>строгих параметров</em> на уровне контроллера. Это позваляет нам прописать какие именно параметры являются <em>обязательными</em>, а какие <em>разрешенными</em>. К тому же, передача чистого хэша <code>params</code> (как это было показано выше) приведет к ошибке, т.е. теперь Rails приложения невосприимчивы к уязвимостям массового назначиния по умолчанию.</p>

<p>В данном случае мы хотим требовать от хэша <code>params</code> наличие атрибута <code>:user</code> и мы хотим позволить наличие атрибутов name, email, password и password_confirmation (но только их). Мы можем достигнуть этого следующим образом:</p>

<div class="code"><div class="highlight"><pre><span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">:password_confirmation</span><span class="p">)</span>
</pre></div>
</div>


<p>Этот код вернет версию хэша <code>params</code> содержащего только разрешенные атрибуты (при этом будет вызвана ошибка если отсутствует атрибут <code>:user</code>).</p>

<p>Для облегчения использования этих параметров, обычно вводят вспомогательный метод с названием <code>user_params</code> который возвращает соответствующий инициализационных хэш используемый вместо <code>params[:user]</code>:</p>

<div class="code"><div class="highlight"><pre><span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">user_params</span><span class="p">)</span>
</pre></div>
</div>


<p>Поскольку <code>user_params</code> будет использоваться только внутри контроллера Users и нет никакой надобности открывать к нему доступ внешним пользователям через веб, мы сделаем его <em>приватным</em> используя ключевое слово <code>private</code>, как это показано в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-create_action_strong_parameters">Листинге&nbsp;7.22</a>. (Мы более детально обсудим <code>private</code> в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#sec-remember_me">Разделе&nbsp;8.2.1</a>.)</p>

<div class="label" id="code-create_action_strong_parameters"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.22.</span> <span class="description">Использование строгих параметров в действии <code>create</code>. <br> <code>app/controllers/users_controller.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">user_params</span><span class="p">)</span>
    <span class="k">if</span> <span class="vi">@user</span><span class="o">.</span><span class="n">save</span>
      <span class="c1"># Handle a successful save.</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="s1">'new'</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">user_params</span>
      <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:password</span><span class="p">,</span>
                                   <span class="ss">:password_confirmation</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>С кодом из <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-create_action_strong_parameters">Листинга&nbsp;7.22</a> тесты отправки невалидных данных должны пройти:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/user_pages_spec.rb <span class="se">\</span>
<span class="gp">&gt;</span> -e <span class="s2">"signup with invalid information"</span>
</pre></div>
</div>




<div class="label" id="sec-signup_error_messages"></div>


<h3><a id="sec-7_3_2" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-signup_error_messages" class="heading"><span class="number">7.3.2</span> Сообщения об ошибках при регистрации</a></h3>


<p>В качестве финального шага в реализации провального создания пользователя мы добавим полезные сообщения об ошибках для указания на проблемы которые помешали регистрации. Rails автоматически предоставляет такие сообщения, основываясь на валидациях модели User. Рассмотрим, например, попытку сохранения пользователя с неправильным адресом электронной почты и коротким паролем:</p>

<div class="code"><div class="highlight"><pre><span class="go">$ rails console</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Foo Bar"</span><span class="p">,</span> <span class="ss">email:</span> <span class="s2">"foo@invalid"</span><span class="p">,</span>
<span class="gp">?&gt; </span>                <span class="ss">password:</span> <span class="s2">"dude"</span><span class="p">,</span> <span class="ss">password_confirmation:</span> <span class="s2">"dude"</span><span class="p">)</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">save</span>
<span class="go">=&gt; false</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">full_messages</span>
<span class="go">=&gt; ["Email is invalid", "Password is too short (minimum is 6 characters)"]</span>
</pre></div>
</div>


<p>Здесь объект <code>errors.full_messages</code> (который мы видели кратко в <a class="ref" href="http://railstutorial.ru/chapters/4_0/modeling-users#sec-presence_validation">Разделе&nbsp;6.2.2</a>) содержит массив сообщений об ошибках.</p>

<p>Как и в консольной сессии выше, сбой сохранения в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-first_create_action">Листинге&nbsp;7.21</a> генерирует список сообщений об ошибках, связанных с объектом <code>@user</code>. Для отображения сообщения в браузере, мы рендерим партиал error_messages на странице user <code>new</code> как это показано в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-f_error_messages">Листинге&nbsp;7.23</a>. (Написание теста на сообщения об ошибках это хорошая идея и мы оставим эти тесты в качестве упражнения; см. <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-signup_exercises">Раздел&nbsp;7.6</a>.) Стоит отметить что этот партиал сообщений об ошибках лишь первая попытка; конечная версия представлена в <a class="ref" href="http://railstutorial.ru/chapters/4_0/user-microposts#sec-creating_microposts">Разделе&nbsp;10.3.2</a>.</p>

<div class="label" id="code-f_error_messages"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.23.</span> <span class="description">Код для отображения сообщений об ошибках в форме регистрации. <br> <code>app/views/users/new.html.erb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s1">'Sign up'</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h1&gt;</span>Sign up<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"span6 offset3"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'shared/error_messages'</span> <span class="cp">%&gt;</span>
      .
      .
      .
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div></div>


<p>Заметим здесь, что мы <code>render</code> партиал <code>’shared/error_messages’</code>; что отражает общую конвенцию Rails, которая предписывает размещение частичных шаблонов которые мы планируем использовать во многих контроллерах в специально отведенном каталоге <code>shared/</code>. Это означает, что мы должны создать этот новый каталог вместе с файлом партиала <code>_error_messages.html.erb</code>. Сам партиал представлен в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-errors_partial">Листинге&nbsp;7.24</a>.</p>

<div class="label" id="code-errors_partial"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.24.</span> <span class="description">Партиал для отображения сообщений об ошибках отправки формы регистрации. <br> <code>app/views/shared/_error_messages.html.erb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="k">if</span> <span class="vi">@user</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">any?</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"error_explanation"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-error"</span><span class="nt">&gt;</span>
      The form contains <span class="cp">&lt;%=</span> <span class="n">pluralize</span><span class="p">(</span><span class="vi">@user</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="s2">"error"</span><span class="p">)</span> <span class="cp">%&gt;</span>.
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
    <span class="cp">&lt;%</span> <span class="vi">@user</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">full_messages</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">msg</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;li&gt;</span>* <span class="cp">&lt;%=</span> <span class="n">msg</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</pre></div>
</div></div>


<p>Этот частичный шаблон вводит несколько новых Rails и Ruby конструкций, в том числе два метода для объекта ошибок Rails. Первый метод это <code>count</code>, который просто возвращает количество ошибок:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">count</span>
<span class="go">=&gt; 2</span>
</pre></div>
</div>

<p>Другой новый метод это <code>any?</code>, который (совместно с <code>empty?</code>) является одним из пары взаимодополняющих методов:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">empty?</span>
<span class="go">=&gt; false</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">any?</span>
<span class="go">=&gt; true</span>
</pre></div>
</div>

<p>Мы видим здесь что метод <code>empty?</code>, который мы впервые увидели в <a class="ref" href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-objects_and_message_passing">Разделе&nbsp;4.2.3</a> в контексте строк, также работает на объекте ошибок Rails, возваращая <code>true</code> для пустого объекта и <code>false</code> в противном случае. Метод <code>any?</code> это просто противоположность <code>empty?</code>, возвращающая <code>true</code> если существует какой-нибудь элемент и <code>false</code> в противном случае. (Кстати, все эти методы — <code>count</code>, <code>empty?</code> и <code>any?</code> — работают и на массивах Ruby. Мы найдем хорошее применение этому факту в <a class="ref" href="http://railstutorial.ru/chapters/4_0/user-microposts#sec-showing_microposts">Разделе&nbsp;10.2</a>.)

</p><p>Другой новой идеей является текстовый хелпер <code>pluralize</code>. По умолчанию, он недоступен в консоли, но мы можем явно его включить через модуль <code>ActionView::Helpers::TextHelper</code>:<sup class="footnote" id="fnref-7_9"><a href="http://railstutorial.ru/chapters/4_0/sign-up#fn-7_9">9</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="kp">include</span> <span class="ss">ActionView::Helpers</span><span class="o">::</span><span class="no">TextHelper</span>
<span class="gp">&gt;&gt; </span><span class="n">pluralize</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"error"</span><span class="p">)</span>
<span class="go">=&gt; "1 error"</span>
<span class="gp">&gt;&gt; </span><span class="n">pluralize</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">"error"</span><span class="p">)</span>
<span class="go">=&gt; "5 errors"</span>
</pre></div>
</div>


<p>Мы видим здесь, что <code>pluralize</code> принимает целочисленный аргумент и возвращает число с правильной версией множественного числа его второго аргумента. В основе этого метода лежит мощный <em>инфлектор</em>, который знает как преобразовать во множественное число огромное количество слов (в том числе, многие с неправильным множественным числом):</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">pluralize</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"woman"</span><span class="p">)</span>
<span class="go">=&gt; "2 women"</span>
<span class="gp">&gt;&gt; </span><span class="n">pluralize</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"erratum"</span><span class="p">)</span>
<span class="go">=&gt; "3 errata"</span>
</pre></div>
</div>


<p>В результате код</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">pluralize</span><span class="p">(</span><span class="vi">@user</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="s2">"error"</span><span class="p">)</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>возвращает <code>"0 errors"</code>, <code>"1 error"</code>, <code>"2 errors"</code> и т.д., в зависимости от количества ошибок, тем самым позволяя нам избежать грамматически неверных фраз вроде <code>"1 errors"</code>.</p>

<p>Обратите внимание: <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-errors_partial">Листинг&nbsp;7.24</a> включает CSS&nbsp;id <code>error_explanation</code> для использования в стилизации сообщений об ошибках. (Напомним из <a class="ref" href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-custom_css">Раздела&nbsp;5.1.2</a> что CSS использует знак решетки <code>#</code> для стилизации id.) Кроме того, Rails автоматически помещает поля с ошибками в <code>div</code>ы с CSS классом <code>field_with_errors</code>. Эти метки затем позволят нам отредактироваь стиль сообщений об ошибках с SCSS показанным в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-error_messages_css">Листинге&nbsp;7.25</a>, который использует Sass функцию <code>@extend</code> для включения функциональности двух классов Bootstrap <code>control-group</code> и <code>error</code>. В результате чего, при провальной регистрации сообщения об ошибках окружены красным как это показано на <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-signup_error_messages">Рис.&nbsp;7.17</a>. Поскольку сообщения генерируются валидациями модели, они автоматически изменятся, если вы когда-нибудь поменяете свое мнение о, скажем, формате адресов электронной почты или минимальной длине паролей.</p>

<div class="label" id="code-error_messages_css"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.24.</span> <span class="description">CSS для стилизации сообщений об ошибках. <br> <code>app/assets/stylesheets/custom.css.scss</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>

<span class="o">/*</span> <span class="nt">forms</span> <span class="o">*/</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nn">#error_explanation</span> <span class="p">{</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#f00</span><span class="p">;</span>
  <span class="nt">ul</span> <span class="p">{</span>
    <span class="na">list-style</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
    <span class="na">margin</span><span class="o">:</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">18</span><span class="kt">px</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nc">.field_with_errors</span> <span class="p">{</span>
  <span class="k">@extend</span> <span class="nc">.control-group</span><span class="o">;</span>
  <span class="o">@</span><span class="nt">extend</span> <span class="nc">.error</span><span class="o">;</span>
<span class="p">}</span>
</pre></div>
</div></div>




<div class="label" id="fig-signup_error_messages"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/signup_error_messages_bootstrap.png" alt="signup_error_messages_bootstrap"></span></div><div class="caption"><span class="header">Рис. 7.17: </span><span class="description">Сбой регистрации с сообщениями об ошибках.&nbsp;<a href="http://railstutorial.org/images/figures/signup_error_messages_bootstrap-full.png">(полный размер)</a></span></div></div>


<p>Для того чтобы увидеть результаты нашей работы в этом разделе, мы повторим шаги из теста провальной регистрации <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-basic_signup_tests">Листинга&nbsp;7.16</a> посетив страницу регистрации и кликнув по “Sign up” с пустыми полями ввода. Результат показан на <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-blank_signup_password_digest">Рис.&nbsp;7.18</a>. Как вы догадываетесь, глядя на рабочую страницу, в этой точке соответствующий тест тоже должен пройти:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/user_pages_spec.rb <span class="se">\</span>
<span class="gp">&gt;</span> -e <span class="s2">"signup with invalid information"</span>
</pre></div>
</div>


<div class="label" id="fig-blank_signup_password_digest"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/blank_signup_password_digest_bootstrap_4_0.png" alt="blank_signup_password_digest_bootstrap_4_0"></span></div><div class="caption"><span class="header">Рис. 7.18: </span><span class="description">Результат посещения <a href="http://localhost:3000/signup">/signup</a> и клика по “Create my account”.&nbsp;<a href="http://railstutorial.org/images/figures/blank_signup_password_digest_bootstrap_4_0-full.png">(полный размер)</a></span></div></div>



<div class="label" id="sec-signup_success"></div>


<h2><a id="sec-7_4" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-signup_success" class="heading"><span class="number">7.4</span> Успешная регистрация</a></h2>


<p>Получив обработку отправки невалидной формы, теперь пришло время для завершения регистрационной формы, на самом деле сохранив нового пользователя (если валидный) в базу данных. Во-первых, мы попробуем сохранить пользователя; если сохранение пройдет успешно, информация пользователя будет записана в базу данных автоматически, а затем мы <em>перенаправим</em> браузер на страницу профиля пользователя (с дружеским приветствием), как это показано на наброске <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-signup_success_mockup">Рис.&nbsp;7.19</a>. Если это не удастся, мы просто отступим к сценарию, разработанному в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-signup_failure">Разделе&nbsp;7.3</a>.</p>

<div class="label" id="fig-signup_success_mockup"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/signup_success_mockup_bootstrap.png" alt="signup_success_mockup_bootstrap"></span></div><div class="caption"><span class="header">Рис. 7.19: </span><span class="description">Набросок успешной регистрации.&nbsp;<a href="http://railstutorial.org/images/figures/signup_success_mockup_bootstrap-full.png">(полный размер)</a></span></div></div>




<div class="label" id="sec-the_finished_signup_form"></div>


<h3><a id="sec-7_4_1" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-the_finished_signup_form" class="heading"><span class="number">7.4.1</span> Завершенная форма регистрации</a></h3>


<p>Для того чтобы закончить работу с формой регистрации, нам необходимо заполнить закомментированный раздел в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-first_create_action">Листинге&nbsp;7.21</a> соответствующим поведением. Сейчас тесты для отправки валидной формы должны быть провальными:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/user_pages_spec.rb <span class="se">\</span>
<span class="gp">&gt;</span> -e <span class="s2">"signup with valid information"</span>
</pre></div>
</div>


<p>Это происходит из-за того что дефолтным поведением для Rails-действий является рендеринг соответствующего представления, но здесь нет (и не должно быть) представления соответствующего действию <code>create</code>. Вместо этого мы должны перенаправить на другую страницу и будет вполне логично если этой страницей будет профиль вновь созданного пользователя. Тестирование того что рендерится правильная страница оставлено в качестве упражнения (<a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-signup_exercises">Раздел&nbsp;7.6</a>); код представлен в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-user_create_action">Листинге&nbsp;7.26</a>.</p>

<div class="label" id="code-user_create_action"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.26.</span> <span class="description">Действие user <code>create</code> с сохранением и переадресацией. <br> <code>app/controllers/users_controller.rb</code></span></div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">user_params</span><span class="p">)</span>
    <span class="k">if</span> <span class="vi">@user</span><span class="o">.</span><span class="n">save</span>
      <span class="n">redirect_to</span> <span class="vi">@user</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="s1">'new'</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">user_params</span>
      <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:password</span><span class="p">,</span>
                                   <span class="ss">:password_confirmation</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Обратите внимание на то что мы можем опустить <code>user_path</code> в редиректе, написав просто <code>redirect_to @user</code> для перенаправления на страницу показывающую пользователя.</p>

<p>С кодом в  <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-user_create_action">Листинге&nbsp;7.26</a> наша регистрационная форма отлично работает, что вы можете проверить запустив набор тестов:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/
</pre></div>
</div>




<div class="label" id="sec-the_flash"></div>


<h3><a id="sec-7_4_2" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-the_flash" class="heading"><span class="number">7.4.2</span> Флэш</a></h3>


<p>Перед отправкой валидной регистрации в браузер мы собираемся немного отполировать ее, в соответствии с общепринятой в веб приложениях идеей: добавив сообщение, которое временно появляется на следующей странице (в данном случае, приветствуя нашего нового пользователя), а затем исчезает либо при посещении следующей страницы либо при перезагрузке текущей. Rails-способ сделать это состоит в использовании специальной переменной <em>flash</em> с которой мы можем обращаться как с обычным хэшем. Вы можете даже вспомнить консольный пример из <a class="ref" href="http://railstutorial.ru/chapters/4_0/rails-flavored-ruby#sec-hashes_and_symbols">Разделе&nbsp;4.3.3</a>, где мы видели как для перебора хэша использовался стратегически именованный хэш <code>flash</code>:</p>

<div class="code"><div class="highlight"><pre><span class="go">$ rails console</span>
<span class="gp">&gt;&gt; </span><span class="n">flash</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">success:</span> <span class="s2">"It worked!"</span><span class="p">,</span> <span class="ss">error:</span> <span class="s2">"It failed."</span> <span class="p">}</span>
<span class="go">=&gt; {:success=&gt;"It worked!", error: "It failed."}</span>
<span class="gp">&gt;&gt; </span><span class="n">flash</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
<span class="gp">?&gt; </span>  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">key</span><span class="si">}</span><span class="s2">"</span>
<span class="gp">?&gt; </span>  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span>
<span class="gp">&gt;&gt; </span><span class="k">end</span>
<span class="go">success</span>
<span class="go">It worked!</span>
<span class="go">error</span>
<span class="go">It failed.</span>
</pre></div>
</div>


<p>Мы можем организовать отображение содержимого флэш повсеместно на сайте, включив его в шаблон нашего приложения, как это показно в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-layout_flash">Листинге&nbsp;7.27</a>. (Этот код представляет из себя особенно уродливую комбинацию HTML и ERb; упражнение в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-signup_exercises">Разделе&nbsp;7.6</a> показывает как сделать его более красивым.)</p>

<div class="label" id="code-layout_flash"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.27.</span> <span class="description">Добавление содержимого переменной <code>flash</code> в шаблон сайта. <br> <code>app/views/layouts/application.html.erb</code></span></div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  .
  .
  .
  <span class="nt">&lt;body&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'layouts/header'</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%</span> <span class="n">flash</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-</span><span class="cp">&lt;%=</span> <span class="n">key</span> <span class="cp">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">&lt;%=</span> <span class="n">value</span> <span class="cp">%&gt;</span><span class="nt">&lt;/div&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'layouts/footer'</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">debug</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="k">if</span> <span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">development?</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    .
    .
    .
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>Код в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-layout_flash">Листинге&nbsp;7.27</a> организует вставку каждого флэш элемента в <code>div</code> тег, с CSS классом, указывающим на тип сообщения. Например, если <code>flash[:success] = "Welcome to the Sample App!"</code>, то код</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">flash</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-</span><span class="cp">&lt;%=</span> <span class="n">key</span> <span class="cp">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">&lt;%=</span> <span class="n">value</span> <span class="cp">%&gt;</span><span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>произведет такой HTML:</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-success"</span><span class="nt">&gt;</span>Welcome to the Sample App!<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>


<p>(Обратите внимание: ключ <code>:success</code> является символом, но встроенный  Ruby автоматически конвертирует его в строку <code>"success"</code> перед вставкой в шаблон.) Причина, по которой мы перебираем все возможные пары ключ/значение заключается в том, что благодаря этому мы сможем включать другие виды флэш сообщений. Например, в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#sec-rendering_with_a_flash_message">Разделе&nbsp;8.1.5</a> мы увидим <code>flash[:error]</code> используемое для индикации неудачной попытки входа на сайт.<sup class="footnote" id="fnref-7_10"><a href="http://railstutorial.ru/chapters/4_0/sign-up#fn-7_10">10</a></sup></p>

<p>Написание теста на правильное флэш сообщение оставлено в качестве упражнения (<a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-signup_exercises">Раздел&nbsp;7.6</a>) и мы можем получить прохождение теста назначив <code>flash[:success]</code> приветственное сообщение в действии <code>create</code> как это показано в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-signup_flash">Листинге&nbsp;7.28</a>.</p>

<div class="label" id="code-signup_flash"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.28.</span> <span class="description">Добавление флеш сообщения к успешной регистрации пользователя. <br> <code>app/controllers/users_controller.rb</code></span></div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">user_params</span><span class="p">)</span>
    <span class="k">if</span> <span class="vi">@user</span><span class="o">.</span><span class="n">save</span>
      <span class="n">flash</span><span class="o">[</span><span class="ss">:success</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"Welcome to the Sample App!"</span>
      <span class="n">redirect_to</span> <span class="vi">@user</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="s1">'new'</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">user_params</span>
      <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:password</span><span class="p">,</span>
                                   <span class="ss">:password_confirmation</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="sec-the_first_signup"></div>


<h3><a id="sec-7_4_3" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-the_first_signup" class="heading"><span class="number">7.4.3</span> Первая регистрация</a></h3>


<p>Вы можете увидеть результат всей этой работы, зарегистрировав нашего первого пользователя под именем “Rails Tutorial” и с адресом электронной почты “<tt>example@railstutorial.org</tt>”. Получившаяся в результате страница (<a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-signup_flash">Рис.&nbsp;7.20</a>) показывает дружеское сообщение после успешной регистрации, включая приятный зеленый стиль для класса <code>success</code>, который был добавлен CSS фреймворком Bootstrap из <a class="ref" href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-custom_css">Раздела&nbsp;5.1.2</a>. (Если вместо этого вы получили сообщение об ошибке указывающее на то что адрес электронной почты уже занят, убедитесь что вы выполнили <code>db:reset</code> Rake-задачу как это предлагалось сделать в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-signup_form">Разделе&nbsp;7.2</a>.) Затем, после перезагрузки страницы профиля пользователя, флэш сообщение исчезает, как и было обещано (<a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-signup_flash_reloaded">Рис.&nbsp;7.21</a>).</p>

<div class="label" id="fig-signup_flash"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/signup_flash_bootstrap.png" alt="signup_flash_bootstrap"></span></div><div class="caption"><span class="header">Рис. 7.20: </span><span class="description">Результирующая страница успешной регистрации с флэш сообщением.&nbsp;<a href="http://railstutorial.org/images/figures/signup_flash_bootstrap-full.png">(полный размер)</a></span></div></div>




<div class="label" id="fig-signup_flash_reloaded"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/signup_flash_reloaded_bootstrap.png" alt="signup_flash_reloaded_bootstrap"></span></div><div class="caption"><span class="header">Рис. 7.21: </span><span class="description">Профиль пользователя с исчезнувшим после перезагрузки страницы флэш сообщением.&nbsp;<a href="http://railstutorial.org/images/figures/signup_flash_reloaded_bootstrap-full.png">(полный размер)</a></span></div></div>


<p>Теперь мы можем проверить нашу базу данных просто для того чтобы еще раз убедиться что новый пользователь действительно создан:</p>

<div class="code"><div class="highlight"><pre><span class="go">$ rails console</span>
<span class="gp">&gt;&gt; </span><span class="no">User</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">email:</span> <span class="s2">"example@railstutorial.org"</span><span class="p">)</span>
<span class="go">=&gt; #&lt;User id: 1, name: "Rails Tutorial", email: "example@railstutorial.org",</span>
<span class="go">created_at: "2013-03-12 05:51:34", updated_at: "2013-03-12 05:51:34",</span>
<span class="go">password_digest: "$2a$10$A58/j7wwh3aAffGkMAO9Q.jjh3jshd.6akhDKtchAz/R..."&gt;</span>
</pre></div>
</div>




<div class="label" id="sec-deploying_to_production_with_ssl"></div>


<h3><a id="sec-7_4_4" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-deploying_to_production_with_ssl" class="heading"><span class="number">7.4.4</span> Развертывание приложения на сервере с SSL</a></h3>


<p>Мы разработали модель User и функционал регистрации, пришло время развернуть пример приложения на сервере. (Если вы еще не выполнили шаги из введения к <a class="ref" href="http://railstutorial.ru/chapters/4_0/static-pages#top">Главе&nbsp;3</a>, вам следует вернуться и сделать это сейчас.) В рамках развертывания мы добавим <a href="http://ru.wikipedia.org/wiki/SSL">Secure Sockets Layer (SSL)</a><sup class="footnote" id="fnref-7_11"><a href="http://railstutorial.ru/chapters/4_0/sign-up#fn-7_11">11</a></sup> к продакшен приложению, тем самым обезопасив регистрацию. Поскольку мы будем реализовывать SSL на стороне сервера, пример приложения будет также обезопасен для входа пользователя (<a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#top">Глава&nbsp;8</a>) и также будет устойчив к уязвимости <em>перехвата сессии</em> (<a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#sec-remember_me">Раздел&nbsp;8.2.1</a>).</p>

<p>В качестве подготовки к развертыванию, вам следует объединить ваши изменения с <code>master</code> веткой:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git add .
<span class="gp">$</span> git commit -m <span class="s2">"Finish user signup"</span>
<span class="gp">$</span> git checkout master
<span class="gp">$</span> git merge sign-up
</pre></div>
</div>


<p>Для того чтобы задеплоить приложение, нам для начала нужно добавить строку инициирующую использование SSL в продакшен. Получившийся в результате конфигурационный файл продакшен окружения <code>config/environments/production.rb</code> представлен в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-ssl_in_production">Листинге&nbsp;7.29</a>.</p>

<div class="label" id="code-ssl_in_production"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.29.</span> <span class="description">Конфигурирование приложения для использования SSL в продакшен. <br> <code>config/environments/production.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="ss">SampleApp::Application</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="c1"># Force all access to the app over SSL, use Strict-Transport-Security,</span>
  <span class="c1"># and use secure cookies.</span>
  <span class="n">config</span><span class="o">.</span><span class="n">force_ssl</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Для того чтобы получить рабочий продакшен сайт, мы должны закоммитить изменения в конфигурационном файле и отправить результат на Heroku:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git commit -a -m <span class="s2">"Add SSL in production"</span>
<span class="gp">$</span> git push heroku
</pre></div>
</div>


<p>Затем нам нужно запустить миграцию на продакшен базе данных для того чтобы сообщить Heroku о модели данных User:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku run rake db:migrate
</pre></div>
</div>


<p>(Вы можете увидеть deprecation предупреждения в этой точке; просто игнорируйте их.)</p>

<p>Наконец, нам необходимо установить SSL на удаленном сервере. Конфигурирование продакшен сайта для использования SSL это довольно неприятная процедура, кроме всего прочего подразумевающая покупку <em>SSL сертификата</em> для вашего домена. К счастью, для приложений запущенных на домене Heroku (таких как наш Пример Приложения), мы можем упасть на хвост SSL сертификату Heroku. Если вы хотите запустить SSL на собственном домене, таком как <code>example.com</code>, вам ничего не остается кроме как немного помучиться, о том как это правильно делать вы можете прочитать на <a href="http://devcenter.heroku.com/articles/ssl">Heroku странице о SSL</a>.</p>

<p>Результатом всей этой работы является рабочая форма регистрации на продакшен сервере (<a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-signup_in_production">Рис.&nbsp;7.22</a>):</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku open
</pre></div>
</div>


<p>Обратите внимание на <tt>https://</tt> вместо обычного http:// (<a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-signup_in_production">Рис.&nbsp;7.22</a>). Дополнительная ‘s’ это указание на то что SSL работает.</p>

<p>Теперь вы можете посетить страницу регистрации и создать нового пользователя. Если возникнут какие-то проблемы, попробуйте выполнить</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku logs
</pre></div>
</div>


<p>для того чтобы отловить ошибку с помощью логов Heroku.</p>

<div class="label" id="fig-signup_in_production"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/signup_in_production_bootstrap.png" alt="signup_in_production_bootstrap"></span></div><div class="caption"><span class="header">Рис. 7.22: </span><span class="description">Рабочая страница регистрации в Web.&nbsp;<a href="http://railstutorial.org/images/figures/signup_in_production_bootstrap-full.png">(полный размер)</a></span></div></div>



<h2><a id="sec-7_5" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-7_5" class="heading"><span class="number">7.5</span> Заключение</a></h2>


<p>Возможность регистрировать пользователей это важная веха для нашего приложения. Хотя пример приложения до сих пор не делает ничего полезного, мы заложили необходимый фундамент для последующей разработки. В <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#top">Главе&nbsp;8</a> мы завершим наш механизм аутентификации позволив пользователям входить и выходить из приложения. В <a class="ref" href="http://railstutorial.ru/chapters/4_0/updating-showing-and-deleting-users#top">Главе&nbsp;9</a> позволим пользователям обновлять информацию в их учетных записях и позволим администраторам сайта удалять пользователей тем самым завершив полный набор REST действий ресурса Users из <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#table-RESTful_users">Таблицы&nbsp;7.1</a>. Наконец, мы добавим методы авторизации к нашим действиям для того чтобы обеспечить безопасность сайта.</p>

<div class="label" id="sec-signup_exercises"></div>


<h2><a id="sec-7_6" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-signup_exercises" class="heading"><span class="number">7.6</span> Упражнения</a></h2>




<ol>

<li>Проверьте что код в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-gravatar_option">Листинге&nbsp;7.30</a> позволяет хелперу <code>gravatar_for</code>, определенному в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#sec-a_gravatar_image">Разделе&nbsp;7.1.4</a> принимать опциональный параметр <code>size</code>, позволив код вроде <code>gravatar_for user, size: 40</code> в представлении.</li>

<li>Напишите тесты для ошибок регистрации реализованных в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-f_error_messages">Листинге&nbsp;7.23</a>. Стартовые рекомендации представлены в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-error_messages_test">Листинге&nbsp;7.31</a>.</li>

<li>Написав вначале тест или намеренно ломая, а затем исправляя код приложения, проверьте что тесты в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-after_save_tests">Листинге&nbsp;7.32</a> правильно описывают поведение после сохранения пользователя в действии <code>create</code>. <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-after_save_tests">Листинг&nbsp;7.32</a> использует метов <code>have_selector</code> представленный в упражнениях <a class="ref" href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#top">Главы&nbsp;5</a> (<a class="ref" href="http://railstutorial.ru/chapters/4_0/filling-in-the-layout#sec-layout_exercises">Раздел&nbsp;5.6</a>). В данном случае мы используем <code>have_selector</code> для выбора определенных CSS классов вместе с конкретными HTML тегами.</li>

<li>Как было отмечено ранее, HTML флэша в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-layout_flash">Листинге&nbsp;7.27</a> уродлив. Проверьте, запустив набор тестов, что очищенный код в <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#code-layout_flash_content_tag">Листинге&nbsp;7.33</a>, использующий Rails хелпер <code>content_tag</code>, тоже работает.</li>
</ol>




<div class="label" id="code-gravatar_option"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.30.</span> <span class="description">Определение необязательного параметра <code>:size</code> для хелпера <code>gravatar_for</code>. <br> <code>app/helpers/users_helper.rb</code></span></div>
<div class="code"><div class="highlight"><pre><span class="k">module</span> <span class="nn">UsersHelper</span>

  <span class="c1"># Returns the Gravatar (http://gravatar.com/) for the given user.</span>
  <span class="k">def</span> <span class="nf">gravatar_for</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">size:</span> <span class="mi">50</span> <span class="p">})</span>
    <span class="n">gravatar_id</span> <span class="o">=</span> <span class="ss">Digest::MD5</span><span class="o">::</span><span class="n">hexdigest</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">downcase</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">options</span><span class="o">[</span><span class="ss">:size</span><span class="o">]</span>
    <span class="n">gravatar_url</span> <span class="o">=</span> <span class="s2">"https://secure.gravatar.com/avatar/</span><span class="si">#{</span><span class="n">gravatar_id</span><span class="si">}</span><span class="s2">?s=</span><span class="si">#{</span><span class="n">size</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">image_tag</span><span class="p">(</span><span class="n">gravatar_url</span><span class="p">,</span> <span class="ss">alt:</span> <span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="ss">class:</span> <span class="s2">"gravatar"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>





<div class="label" id="code-error_messages_test"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.31.</span> <span class="description">Рекомендуемые тесты для сообщений об ошибках. <br> <code>spec/requests/user_pages_spec.rb</code></span></div>
<div class="code"><div class="highlight"><pre>  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="n">describe</span> <span class="s2">"signup"</span> <span class="k">do</span>

    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">signup_path</span> <span class="p">}</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="n">describe</span> <span class="s2">"with invalid information"</span> <span class="k">do</span>
      <span class="o">.</span>
      <span class="o">.</span>
      <span class="o">.</span>
      <span class="n">describe</span> <span class="s2">"after submission"</span> <span class="k">do</span>
        <span class="n">before</span> <span class="p">{</span> <span class="n">click_button</span> <span class="n">submit</span> <span class="p">}</span>

        <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_title</span><span class="p">(</span><span class="s1">'Sign up'</span><span class="p">)</span> <span class="p">}</span>
        <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">'error'</span><span class="p">)</span> <span class="p">}</span>
      <span class="k">end</span>
      <span class="o">.</span>
      <span class="o">.</span>
      <span class="o">.</span>
</pre></div>
</div></div>




<div class="label" id="code-after_save_tests"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.32.</span> <span class="description">Тесты описывающие поведение после сохранения в действии <code>create</code>. <br> <code>spec/requests/user_pages_spec.rb</code></span></div>
<div class="code"><div class="highlight"><pre>    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="n">describe</span> <span class="s2">"with valid information"</span> <span class="k">do</span>
      <span class="o">.</span>
      <span class="o">.</span>
      <span class="o">.</span>
      <span class="n">describe</span> <span class="s2">"after saving the user"</span> <span class="k">do</span>
        <span class="n">before</span> <span class="p">{</span> <span class="n">click_button</span> <span class="n">submit</span> <span class="p">}</span>
        <span class="n">let</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">{</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">email:</span> <span class="s1">'user@example.com'</span><span class="p">)</span> <span class="p">}</span>

        <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_title</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="p">}</span>
        <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">'div.alert.alert-success'</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">'Welcome'</span><span class="p">)</span> <span class="p">}</span>
      <span class="k">end</span>
      <span class="o">.</span>
      <span class="o">.</span>
      <span class="o">.</span>
</pre></div>
</div></div>




<div class="label" id="code-layout_flash_content_tag"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 7.33.</span> <span class="description">ERb для <code>flash</code> в шаблоне сайта использующий <code>content_tag</code>. <br> <code>app/views/layouts/application.html.erb</code></span></div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
      .
      .
      .
      <span class="cp">&lt;%</span> <span class="n">flash</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">content_tag</span><span class="p">(</span><span class="ss">:div</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="ss">class:</span> <span class="s2">"alert alert-</span><span class="si">#{</span><span class="n">key</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
      .
      .
      .
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<div class="navigation">  <a class="prev_page" href="http://railstutorial.ru/chapters/4_0/modeling-users#top">
    «&nbsp;<span class="number">Глава 6</span> Моделирование пользователей
  </a>
  <a class="next_page" href="http://railstutorial.ru/chapters/4_0/sign-in-sign-out#top">
    <span class="number">Глава 8</span> Войти, выйти&nbsp;»
  </a>
</div><div class="footnotes">
<ol>
<li id="fn-7_1"><a href="http://gomockingbird.com/">Mockingbird</a> не поддерживает кастомные изображения вроде фото на <a class="ref" href="http://railstutorial.ru/chapters/4_0/sign-up#fig-profile_mockup_profile_name">Рис.&nbsp;7.1</a>; я добавил его вручную с помощью <a href="http://www.adobe.com/products/fireworks/">Adobe Fireworks</a>. &nbsp;<a class="arrow" href="http://railstutorial.ru/chapters/4_0/sign-up#fnref-7_1">↑</a></li>
<li id="fn-7_2">Гиппопотам был взят с <a href="http://www.flickr.com/photos/43803060@N00/24308857/">http://www.flickr.com/photos/43803060@N00/24308857/</a>.&nbsp;<a class="arrow" href="http://railstutorial.ru/chapters/4_0/sign-up#fnref-7_2">↑</a></li>
<li id="fn-7_3">Rails <code>debug</code> информация показана как <a href="http://www.yaml.org/">YAML</a> (a <a href="http://catb.org/jargon/html/R/recursive-acronym.html">recursive acronym</a> (или <a href="http://ru.wikipedia.org/wiki/%D0%A0%D0%B5%D0%BA%D1%83%D1%80%D1%81%D0%B8%D0%B2%D0%BD%D1%8B%D0%B9_%D0%B0%D0%BA%D1%80%D0%BE%D0%BD%D0%B8%D0%BC">рекурсивный акроним)</a>)  обозначающий “<a href="http://ru.wikipedia.org/wiki/YAML">YAML</a> Ain’t Markup Language”), который является дружественным форматом данных, разработанным так, чтобы быть удобочитаемым и для машин и для людей.&nbsp;<a class="arrow" href="http://railstutorial.ru/chapters/4_0/sign-up#fnref-7_3">↑</a></li>
<li id="fn-7_4">Вы также можете определять собственные окружения; см. <a href="http://railscasts.com/episodes/72-adding-an-environment">RailsCast on adding an environment</a>.&nbsp;<a class="arrow" href="http://railstutorial.ru/chapters/4_0/sign-up#fnref-7_4">↑</a></li>
<li id="fn-7_5">Это означает что <em>маршрутизация</em> работает, но соответствующие страницы необязательно должны работать в этой точке. Например, /users/1/edit правильно направляется к <code>edit</code> действию контроллера Users, но поскольку действие <code>edit</code> пока не существует, обращение к этому URL вернет ошибку.&nbsp;<a class="arrow" href="http://railstutorial.ru/chapters/4_0/sign-up#fnref-7_5">↑</a></li>
<li id="fn-7_6">В индуизме, аватар это форма проявление божества в человеке или животном. В более широком смысле термин <em>avatar</em> обычно используется для обозначения  персонализации пользователя, особенно в виртуальной среде. Но вы уже видели <a href="http://www.imdb.com/title/tt0499549/">фильм</a>, и почти наверняка знаете об этом.&nbsp;<a class="arrow" href="http://railstutorial.ru/chapters/4_0/sign-up#fnref-7_6">↑</a></li>
<li id="fn-7_7">Если вашему приложению потребуется обработка кастомных изображений или загрузки других файлов, я рекомендую использовать для этих целей гем <a href="http://github.com/thoughtbot/paperclip">Paperclip</a>.&nbsp;<a class="arrow" href="http://railstutorial.ru/chapters/4_0/sign-up#fnref-7_7">↑</a></li>
<li id="fn-7_8">Странно, не правда ли? Я тоже этого не понимаю.&nbsp;<a class="arrow" href="http://railstutorial.ru/chapters/4_0/sign-up#fnref-7_8">↑</a></li>
<li id="fn-7_9">Я выяснил это путем поиска <code>pluralize</code> в <a href="http://api.rubyonrails.org/v4.0.0/classes/ActionView/Helpers/TextHelper.html#method-i-pluralize">Rails API</a>.&nbsp;<a class="arrow" href="http://railstutorial.ru/chapters/4_0/sign-up#fnref-7_9">↑</a></li>
<li id="fn-7_10">На самом деле мы будем использовать тесно связанный <code>flash.now</code>, но мы отложим эти тонкости до тех пор пока они нам не понадобятся.&nbsp;<a class="arrow" href="http://railstutorial.ru/chapters/4_0/sign-up#fnref-7_10">↑</a></li>
<li id="fn-7_11">Технически, SSL это теперь TLS, от Transport Layer Security, но все кого я знаю по-прежнему говорят “SSL”.&nbsp;<a class="arrow" href="http://railstutorial.ru/chapters/4_0/sign-up#fnref-7_11">↑</a></li>
</ol>
</div>

    </div>
  <div id="book_bottom">
  </div>
</div>
</div><script type="text/javascript">
    var reformalOptions = {
        project_id: 36662,
        project_host: "RoR.reformal.ru",
        tab_orientation: "left",
        tab_indent: "50%",
        tab_bg_color: "#6b0508",
        tab_border_color: "#FFFFFF",
        tab_image_url: "http://tab.reformal.ru/T9GC0LfRi9Cy0Ysg0Lgg0L%252FRgNC10LTQu9C%252B0LbQtdC90LjRjw==/FFFFFF/4bfb34d91c8d7fb481972ca3c84aec38/left/0/tab.png",
        tab_border_width: 1
    };

    (function() {
        var script = document.createElement('script');
        script.type = 'text/javascript'; script.async = true;
        script.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'media.reformal.ru/widgets/v3/reformal.js';
        document.getElementsByTagName('head')[0].appendChild(script);
    })();
</script>
<div class="orphus center"><script src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/orphus.js" type="text/javascript"></script></div><!-- Yandex.Metrika counter -->
<div style="display:none;"><script type="text/javascript">
(function(w, c) {
    (w[c] = w[c] || []).push(function() {
        try {
            w.yaCounter5083948 = new Ya.Metrika(5083948);
             yaCounter5083948.clickmap(true);
             yaCounter5083948.trackLinks(true);

        } catch(e) { }
    });
})(window, 'yandex_metrika_callbacks');
</script></div>
<script src="./Перевод Ruby on Rails Tutorial  Изучение Rails на Примерах   Ruby on Rails 3 Tutorial book and screencasts   by Michael Hartl_files/watch.js" type="text/javascript" defer="defer"></script>
<noscript>&lt;div&gt;&lt;img src="//mc.yandex.ru/watch/5083948" style="position:absolute; left:-9999px;" alt="" /&gt;&lt;/div&gt;</noscript>
<!-- /Yandex.Metrika counter --></div></div></body></html>